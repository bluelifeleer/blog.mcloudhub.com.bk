{"version":3,"sources":["../../../../../../app/public/js/marked/src/editormd.js"],"names":["factory","require","exports","module","define","amd","window","editormd","$","jQuery","Zepto","id","options","fn","init","title","$name","version","homePage","classPrefix","toolbarModes","full","simple","mini","defaults","mode","name","value","theme","editorTheme","previewTheme","markdown","appendMarkdown","width","height","path","pluginPath","delay","autoLoadModules","watch","placeholder","gotoLine","codeFold","autoHeight","autoFocus","autoCloseTags","searchReplace","syncScrolling","readOnly","tabSize","indentUnit","lineNumbers","lineWrapping","autoCloseBrackets","showTrailingSpace","matchBrackets","indentWithTabs","styleSelectedText","matchWordHighlight","styleActiveLine","dialogLockScreen","dialogShowMask","dialogDraggable","dialogMaskBgColor","dialogMaskOpacity","fontSize","saveHTMLToTextarea","disabledKeyMaps","onload","onresize","onchange","onwatch","onunwatch","onpreviewing","onpreviewed","onfullscreen","onfullscreenExit","onscroll","onpreviewscroll","imageUpload","imageFormats","imageUploadURL","crossDomainUpload","uploadCallbackURL","toc","tocm","tocTitle","tocDropdown","tocContainer","tocStartLevel","htmlDecode","pageBreak","atLink","emailLink","taskList","emoji","tex","flowChart","sequenceDiagram","previewCodeHighlight","toolbar","toolbarAutoFixed","toolbarIcons","toolbarTitles","toolbarHandlers","ucwords","lowercase","toolbarCustomIcons","toolbarIconsClass","undo","redo","bold","del","italic","quote","uppercase","h1","h2","h3","h4","h5","h6","hr","link","image","code","table","datetime","pagebreak","unwatch","preview","search","fullscreen","clear","help","info","toolbarIconTexts","lang","description","buttons","enter","cancel","close","dialog","url","urlTitle","urlEmpty","referenceLink","urlId","nameEmpty","idEmpty","alt","uploadButton","imageURLEmpty","uploadFileEmpty","formatNotAllowed","preformattedText","emptyAlert","codeBlock","selectLabel","selectDefaultText","otherLanguage","unselectedLanguageAlert","codeEmptyAlert","htmlEntities","classNames","dialogZindex","$katex","$marked","$CodeMirror","$prettyPrint","timer","flowchartTimer","prototype","state","watching","loaded","_this","settings","extend","editor","textarea","html","hasClass","addClass","css","markdownTextarea","children","length","append","attr","appendElements","join","mask","containerMask","val","htmlTextarea","previewContainer","katex","loadCSS","CodeMirror","marked","setCodeMirror","setToolbar","loadedDisplay","loadQueues","loadPath","loadFlowChartOrSequenceDiagram","isIE8","loadScript","setTheme","oldTheme","themePrefix","removeClass","setEditorTheme","cm","setOption","setCodeMirrorTheme","setPreviewTheme","codeMirrorConfig","dragDrop","autofocus","extraKeys","foldCode","getCursor","foldGutter","gutters","highlightSelectionMatches","showToken","codeEditor","fromTextArea","codeMirror","cmElement","setValue","Infinity","find","getCodeMirrorOption","key","getOption","setCodeMirrorOption","addKeyMap","map","bottom","removeKeyMap","line","count","lineCount","alert","parseInt","setCursor","ch","scrollInfo","getScrollInfo","clientHeight","coords","charCoords","scrollTo","top","cmScroll","scrollTop","percent","scrollHeight","focus","arguments","proxy","set","config","recreate","on","eventType","callback","off","showToolbar","show","resize","hideToolbar","hide","setToolbarAutoFixed","fixed","autoFixedHandle","$window","offset","position","left","bind","toolbarHTML","icons","toolbarMenu","menu","pullRight","i","len","isHeader","test","index","iconTexts","iconClass","menuItem","toUpperCase","setToolbarHandler","getToolbarHandles","toolbarIconHandlers","mouseOrTouch","event","icon","cursor","selection","getSelection","activeIcon","createDialog","createInfoDialog","infoDialogHTML","infoDialog","hideInfoDialog","infoDialogPosition","_infoDialogPosition","showInfoDialog","lockScreen","opacity","backgroundColor","lock","remove","prettyPrint","katexRender","each","render","text","flowChartAndSequenceDiagramRender","$this","codeView","tocHeight","tocMenuHeight","registerKeyMaps","keyMap","inArray","k","keyMaps","_keyMap","handle","_map","keydown","keymaps","keyCode","bindScrollEvent","cmBindScroll","cmUnbindScroll","unbind","previewBindScroll","previewUnbindScroll","mouseover","mouseout","touchstart","touchend","bindChangeEvent","_cm","changeObj","setTimeout","clearTimeout","save","data","previewHeight","cmValue","getValue","markdownToC","rendererOptions","markedRendererOptions","markedOptions","renderer","markedRenderer","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","setOptions","newMarkdownDoc","filterHTMLTags","tocMenu","markdownToCRenderer","tocDropdownMenu","kaTeXLoaded","loadKaTeX","setSelection","from","to","setSelections","ranges","getSelections","replaceSelection","insertValue","md","setMarkdown","getMarkdown","getHTML","getTextareaSavedHTML","getPreviewedHTML","watchIcon","unWatchIcon","parent","previewing","toggle","toggleClass","escHandle","shiftKey","previewed","previewCloseBtn","background","fullscreenClass","fullscreenExit","executePlugin","loadFiles","plugin","loadPlugin","loadPlugins","command","execCommand","searchReplaceAll","ucfirst","selections","listSelections","firstUpperCase","wordsFirstUpperCase","toLowerCase","selectionText","split","date","Date","langName","datefmt","dateFormat","isMac","navigator","platform","indexOf","trim","str","String","replace","$1","urls","atLinkBase","regexs","email","emojiDatetime","twemoji","fontAwesome","editormdLogo","ext","Renderer","atLinkReg","emojiReg","emailReg","emailLinkReg","twemojiReg","faIconReg","editormdLogoReg","pageBreakReg","matchs","match","RegExp","$2","faMatchs","fa","len1","faName","emdlogoMathcs","twemojiMatchs","x","len2","logoName","t","len3","twe","src","$3","$4","$5","href","prot","decodeURIComponent","unescape","e","out","heading","level","raw","linkText","hasLinkReg","getLinkTextReg","tempText","push","escapedText","slug","isChinese","escape","headingHTML","headerPrefix","paragraph","isTeXInline","isTeXLine","isTeXAddClass","isToC","isToCMenu","tocHTML","escaped","apply","tablecell","content","flags","type","header","tag","align","listitem","container","startLevel","lastLevel","Array","wrap","zindex","tocMenus","btn","list","first","before","li","ul","firstA","float","paddingTop","mouseleave","filters","expression","filterTags","attrs","htmlTagRegex","el","_attrs","attributes","$attrs","nodeName","nodeValue","outerHTML","filterAttrs","markdownToHTML","markdownSourceCode","autoLoadKaTeX","div","saveTo","markdownDoc","markdownParsed","katexHandle","themes","previewThemes","editorThemes","js","fileName","into","document","createElement","rel","onreadystatechange","getElementsByTagName","appendChild","body","isIE","appName","appVersion","script","readyState","katexURL","drag","closed","maskStyle","footer","guid","getTime","dialogName","showMask","hideMask","loading","zIndex","border","dialogPosition","btnClassName","posX","posY","dialogHeader","mousedown","clientX","style","clientY","onmousemove","moveAction","userCanSelect","obj","userUnselect","nowLeft","nowTop","onselectstart","onmouseup","touchDraggable","start","orig","originalEvent","pos","changedTouches","pageX","y","pageY","move","preventDefault","mouseEventType","touchEventType","createEvent","format","addZero","d","year","getFullYear","year2","toString","slice","month","getMonth","day","getDate","weekDay","getDay","hour","getHours","min","getMinutes","second","getSeconds","ms","getMilliseconds","ymd","fymd","hms","toUTCString","cnWeekDays","weekDays"],"mappings":"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","file":"editormd.js","sourcesContent":[";(function(factory) {\r\n    \"use strict\";\r\n    \r\n\t// CommonJS/Node.js\r\n\tif (typeof require === \"function\" && typeof exports === \"object\" && typeof module === \"object\")\r\n    { \r\n        module.exports = factory;\r\n    }\r\n\telse if (typeof define === \"function\")  // AMD/CMD/Sea.js\r\n\t{\r\n        if (define.amd) // for Require.js\r\n        {\r\n            /* Require.js define replace */\r\n        } \r\n        else \r\n        {\r\n\t\t    define([\"jquery\"], factory);  // for Sea.js\r\n        }\r\n\t} \r\n\telse\r\n\t{ \r\n        window.editormd = factory();\r\n\t}\r\n    \r\n}(function() {    \r\n\r\n    /* Require.js assignment replace */\r\n    \r\n    \"use strict\";\r\n    \r\n    var $ = (typeof (jQuery) !== \"undefined\") ? jQuery : Zepto;\r\n\r\n\tif (typeof ($) === \"undefined\") {\r\n\t\treturn ;\r\n\t}\r\n    \r\n    /**\r\n     * editormd\r\n     * \r\n     * @param   {String} id           ID\r\n     * @param   {Object} options       Key/Value\r\n     * @returns {Object} editormd     editormd\r\n     */\r\n    \r\n    var editormd         = function (id, options) {\r\n        return new editormd.fn.init(id, options);\r\n    };\r\n    \r\n    editormd.title        = editormd.$name = \"Editor.md\";\r\n    editormd.version      = \"1.5.0\";\r\n    editormd.homePage     = \"https://pandao.github.io/editor.md/\";\r\n    editormd.classPrefix  = \"editormd-\";\r\n    \r\n    editormd.toolbarModes = {\r\n        full : [\r\n            \"undo\", \"redo\", \"|\", \r\n            \"bold\", \"del\", \"italic\", \"quote\", \"ucwords\", \"uppercase\", \"lowercase\", \"|\", \r\n            \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"|\", \r\n            \"list-ul\", \"list-ol\", \"hr\", \"|\",\r\n            \"link\", \"reference-link\", \"image\", \"code\", \"preformatted-text\", \"code-block\", \"table\", \"datetime\", \"emoji\", \"html-entities\", \"pagebreak\", \"|\",\r\n            \"goto-line\", \"watch\", \"preview\", \"fullscreen\", \"clear\", \"search\", \"|\",\r\n            \"help\", \"info\"\r\n        ],\r\n        simple : [\r\n            \"undo\", \"redo\", \"|\", \r\n            \"bold\", \"del\", \"italic\", \"quote\", \"uppercase\", \"lowercase\", \"|\", \r\n            \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"|\", \r\n            \"list-ul\", \"list-ol\", \"hr\", \"|\",\r\n            \"watch\", \"preview\", \"fullscreen\", \"|\",\r\n            \"help\", \"info\"\r\n        ],\r\n        mini : [\r\n            \"undo\", \"redo\", \"|\",\r\n            \"watch\", \"preview\", \"|\",\r\n            \"help\", \"info\"\r\n        ]\r\n    };\r\n    \r\n    editormd.defaults     = {\r\n        mode                 : \"gfm\",          //gfm or markdown\r\n        name                 : \"\",             // Form element name\r\n        value                : \"\",             // value for CodeMirror, if mode not gfm/markdown\r\n        theme                : \"\",             // Editor.md self themes, before v1.5.0 is CodeMirror theme, default empty\r\n        editorTheme          : \"default\",      // Editor area, this is CodeMirror theme at v1.5.0\r\n        previewTheme         : \"\",             // Preview area theme, default empty\r\n        markdown             : \"\",             // Markdown source code\r\n        appendMarkdown       : \"\",             // if in init textarea value not empty, append markdown to textarea\r\n        width                : \"100%\",\r\n        height               : \"100%\",\r\n        path                 : \"./lib/\",       // Dependents module file directory\r\n        pluginPath           : \"\",             // If this empty, default use settings.path + \"../plugins/\"\r\n        delay                : 300,            // Delay parse markdown to html, Uint : ms\r\n        autoLoadModules      : true,           // Automatic load dependent module files\r\n        watch                : true,\r\n        placeholder          : \"Enjoy Markdown! coding now...\",\r\n        gotoLine             : true,\r\n        codeFold             : false,\r\n        autoHeight           : false,\r\n\t\tautoFocus            : true,\r\n        autoCloseTags        : true,\r\n        searchReplace        : true,\r\n        syncScrolling        : true,           // true | false | \"single\", default true\r\n        readOnly             : false,\r\n        tabSize              : 4,\r\n\t\tindentUnit           : 4,\r\n        lineNumbers          : true,\r\n\t\tlineWrapping         : true,\r\n\t\tautoCloseBrackets    : true,\r\n\t\tshowTrailingSpace    : true,\r\n\t\tmatchBrackets        : true,\r\n\t\tindentWithTabs       : true,\r\n\t\tstyleSelectedText    : true,\r\n        matchWordHighlight   : true,           // options: true, false, \"onselected\"\r\n        styleActiveLine      : true,           // Highlight the current line\r\n        dialogLockScreen     : true,\r\n        dialogShowMask       : true,\r\n        dialogDraggable      : true,\r\n        dialogMaskBgColor    : \"#fff\",\r\n        dialogMaskOpacity    : 0.1,\r\n        fontSize             : \"13px\",\r\n        saveHTMLToTextarea   : false,\r\n        disabledKeyMaps      : [],\r\n        \r\n        onload               : function() {},\r\n        onresize             : function() {},\r\n        onchange             : function() {},\r\n        onwatch              : null,\r\n        onunwatch            : null,\r\n        onpreviewing         : function() {},\r\n        onpreviewed          : function() {},\r\n        onfullscreen         : function() {},\r\n        onfullscreenExit     : function() {},\r\n        onscroll             : function() {},\r\n        onpreviewscroll      : function() {},\r\n        \r\n        imageUpload          : false,\r\n        imageFormats         : [\"jpg\", \"jpeg\", \"gif\", \"png\", \"bmp\", \"webp\"],\r\n        imageUploadURL       : \"\",\r\n        crossDomainUpload    : false,\r\n        uploadCallbackURL    : \"\",\r\n        \r\n        toc                  : true,           // Table of contents\r\n        tocm                 : false,           // Using [TOCM], auto create ToC dropdown menu\r\n        tocTitle             : \"\",             // for ToC dropdown menu btn\r\n        tocDropdown          : false,\r\n        tocContainer         : \"\",\r\n        tocStartLevel        : 1,              // Said from H1 to create ToC\r\n        htmlDecode           : false,          // Open the HTML tag identification \r\n        pageBreak            : true,           // Enable parse page break [========]\r\n        atLink               : true,           // for @link\r\n        emailLink            : true,           // for email address auto link\r\n        taskList             : false,          // Enable Github Flavored Markdown task lists\r\n        emoji                : false,          // :emoji: , Support Github emoji, Twitter Emoji (Twemoji);\r\n                                               // Support FontAwesome icon emoji :fa-xxx: > Using fontAwesome icon web fonts;\r\n                                               // Support Editor.md logo icon emoji :editormd-logo: :editormd-logo-1x: > 1~8x;\r\n        tex                  : false,          // TeX(LaTeX), based on KaTeX\r\n        flowChart            : false,          // flowChart.js only support IE9+\r\n        sequenceDiagram      : false,          // sequenceDiagram.js only support IE9+\r\n        previewCodeHighlight : true,\r\n                \r\n        toolbar              : true,           // show/hide toolbar\r\n        toolbarAutoFixed     : true,           // on window scroll auto fixed position\r\n        toolbarIcons         : \"full\",\r\n        toolbarTitles        : {},\r\n        toolbarHandlers      : {\r\n            ucwords : function() {\r\n                return editormd.toolbarHandlers.ucwords;\r\n            },\r\n            lowercase : function() {\r\n                return editormd.toolbarHandlers.lowercase;\r\n            }\r\n        },\r\n        toolbarCustomIcons   : {               // using html tag create toolbar icon, unused default <a> tag.\r\n            lowercase        : \"<a href=\\\"javascript:;\\\" title=\\\"Lowercase\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"lowercase\\\" style=\\\"font-size:24px;margin-top: -10px;\\\">a</i></a>\",\r\n            \"ucwords\"        : \"<a href=\\\"javascript:;\\\" title=\\\"ucwords\\\" unselectable=\\\"on\\\"><i class=\\\"fa\\\" name=\\\"ucwords\\\" style=\\\"font-size:20px;margin-top: -3px;\\\">Aa</i></a>\"\r\n        }, \r\n        toolbarIconsClass    : {\r\n            undo             : \"fa-undo\",\r\n            redo             : \"fa-repeat\",\r\n            bold             : \"fa-bold\",\r\n            del              : \"fa-strikethrough\",\r\n            italic           : \"fa-italic\",\r\n            quote            : \"fa-quote-left\",\r\n            uppercase        : \"fa-font\",\r\n            h1               : editormd.classPrefix + \"bold\",\r\n            h2               : editormd.classPrefix + \"bold\",\r\n            h3               : editormd.classPrefix + \"bold\",\r\n            h4               : editormd.classPrefix + \"bold\",\r\n            h5               : editormd.classPrefix + \"bold\",\r\n            h6               : editormd.classPrefix + \"bold\",\r\n            \"list-ul\"        : \"fa-list-ul\",\r\n            \"list-ol\"        : \"fa-list-ol\",\r\n            hr               : \"fa-minus\",\r\n            link             : \"fa-link\",\r\n            \"reference-link\" : \"fa-anchor\",\r\n            image            : \"fa-picture-o\",\r\n            code             : \"fa-code\",\r\n            \"preformatted-text\" : \"fa-file-code-o\",\r\n            \"code-block\"     : \"fa-file-code-o\",\r\n            table            : \"fa-table\",\r\n            datetime         : \"fa-clock-o\",\r\n            emoji            : \"fa-smile-o\",\r\n            \"html-entities\"  : \"fa-copyright\",\r\n            pagebreak        : \"fa-newspaper-o\",\r\n            \"goto-line\"      : \"fa-terminal\", // fa-crosshairs\r\n            watch            : \"fa-eye-slash\",\r\n            unwatch          : \"fa-eye\",\r\n            preview          : \"fa-desktop\",\r\n            search           : \"fa-search\",\r\n            fullscreen       : \"fa-arrows-alt\",\r\n            clear            : \"fa-eraser\",\r\n            help             : \"fa-question-circle\",\r\n            info             : \"fa-info-circle\"\r\n        },        \r\n        toolbarIconTexts     : {},\r\n        \r\n        lang : {\r\n            name        : \"zh-cn\",\r\n            description : \"Markdown<br/>Open source online Markdown editor.\",\r\n            tocTitle    : \"\",\r\n            toolbar     : {\r\n                undo             : \"Ctrl+Z\",\r\n                redo             : \"Ctrl+Y\",\r\n                bold             : \"\",\r\n                del              : \"\",\r\n                italic           : \"\",\r\n                quote            : \"\",\r\n                ucwords          : \"\",\r\n                uppercase        : \"\",\r\n                lowercase        : \"\",\r\n                h1               : \"1\",\r\n                h2               : \"2\",\r\n                h3               : \"3\",\r\n                h4               : \"4\",\r\n                h5               : \"5\",\r\n                h6               : \"6\",\r\n                \"list-ul\"        : \"\",\r\n                \"list-ol\"        : \"\",\r\n                hr               : \"\",\r\n                link             : \"\",\r\n                \"reference-link\" : \"\",\r\n                image            : \"\",\r\n                code             : \"\",\r\n                \"preformatted-text\" : \" / \",\r\n                \"code-block\"     : \"\",\r\n                table            : \"\",\r\n                datetime         : \"\",\r\n                emoji            : \"Emoji\",\r\n                \"html-entities\"  : \"HTML\",\r\n                pagebreak        : \"\",\r\n                \"goto-line\"      : \"\",\r\n                watch            : \"\",\r\n                unwatch          : \"\",\r\n                preview          : \"HTML Shift + ESC\",\r\n                fullscreen       : \"ESC\",\r\n                clear            : \"\",\r\n                search           : \"\",\r\n                help             : \"\",\r\n                info             : \"\" + editormd.title\r\n            },\r\n            buttons : {\r\n                enter  : \"\",\r\n                cancel : \"\",\r\n                close  : \"\"\r\n            },\r\n            dialog : {\r\n                link : {\r\n                    title    : \"\",\r\n                    url      : \"\",\r\n                    urlTitle : \"\",\r\n                    urlEmpty : \"\"\r\n                },\r\n                referenceLink : {\r\n                    title    : \"\",\r\n                    name     : \"\",\r\n                    url      : \"\",\r\n                    urlId    : \"ID\",\r\n                    urlTitle : \"\",\r\n                    nameEmpty: \"\",\r\n                    idEmpty  : \"ID\",\r\n                    urlEmpty : \"URL\"\r\n                },\r\n                image : {\r\n                    title    : \"\",\r\n                    url      : \"\",\r\n                    link     : \"\",\r\n                    alt      : \"\",\r\n                    uploadButton     : \"\",\r\n                    imageURLEmpty    : \"\",\r\n                    uploadFileEmpty  : \"\",\r\n                    formatNotAllowed : \"\"\r\n                },\r\n                preformattedText : {\r\n                    title             : \"\", \r\n                    emptyAlert        : \"\"\r\n                },\r\n                codeBlock : {\r\n                    title             : \"\",                    \r\n                    selectLabel       : \"\",\r\n                    selectDefaultText : \"\",\r\n                    otherLanguage     : \"\",\r\n                    unselectedLanguageAlert : \"\",\r\n                    codeEmptyAlert    : \"\"\r\n                },\r\n                htmlEntities : {\r\n                    title : \"HTML \"\r\n                },\r\n                help : {\r\n                    title : \"\"\r\n                }\r\n            }\r\n        }\r\n    };\r\n    \r\n    editormd.classNames  = {\r\n        tex : editormd.classPrefix + \"tex\"\r\n    };\r\n\r\n    editormd.dialogZindex = 99999;\r\n    \r\n    editormd.$katex       = null;\r\n    editormd.$marked      = null;\r\n    editormd.$CodeMirror  = null;\r\n    editormd.$prettyPrint = null;\r\n    \r\n    var timer, flowchartTimer;\r\n\r\n    editormd.prototype    = editormd.fn = {\r\n        state : {\r\n            watching   : false,\r\n            loaded     : false,\r\n            preview    : false,\r\n            fullscreen : false\r\n        },\r\n        \r\n        /**\r\n         * /\r\n         * Constructor / instance initialization\r\n         * \r\n         * @param   {String}   id            ID\r\n         * @param   {Object}   [options={}]   Key/Value\r\n         * @returns {editormd}               editormd\r\n         */\r\n        \r\n        init : function (id, options) {\r\n            \r\n            options              = options || {};\r\n            \r\n            if (typeof id === \"object\")\r\n            {\r\n                options = id;\r\n            }\r\n            \r\n            var _this            = this;\r\n            var classPrefix      = this.classPrefix  = editormd.classPrefix; \r\n            var settings         = this.settings     = $.extend(true, editormd.defaults, options);\r\n            \r\n            id                   = (typeof id === \"object\") ? settings.id : id;\r\n            \r\n            var editor           = this.editor       = $(\"#\" + id);\r\n            \r\n            this.id              = id;\r\n            this.lang            = settings.lang;\r\n            \r\n            var classNames       = this.classNames   = {\r\n                textarea : {\r\n                    html     : classPrefix + \"html-textarea\",\r\n                    markdown : classPrefix + \"markdown-textarea\"\r\n                }\r\n            };\r\n            \r\n            settings.pluginPath = (settings.pluginPath === \"\") ? settings.path + \"../plugins/\" : settings.pluginPath; \r\n            \r\n            this.state.watching = (settings.watch) ? true : false;\r\n            \r\n            if ( !editor.hasClass(\"editormd\") ) {\r\n                editor.addClass(\"editormd\");\r\n            }\r\n            \r\n            editor.css({\r\n                width  : (typeof settings.width  === \"number\") ? settings.width  + \"px\" : settings.width,\r\n                height : (typeof settings.height === \"number\") ? settings.height + \"px\" : settings.height\r\n            });\r\n            \r\n            if (settings.autoHeight)\r\n            {\r\n                editor.css(\"height\", \"auto\");\r\n            }\r\n                        \r\n            var markdownTextarea = this.markdownTextarea = editor.children(\"textarea\");\r\n            \r\n            if (markdownTextarea.length < 1)\r\n            {\r\n                editor.append(\"<textarea></textarea>\");\r\n                markdownTextarea = this.markdownTextarea = editor.children(\"textarea\");\r\n            }\r\n            \r\n            markdownTextarea.addClass(classNames.textarea.markdown).attr(\"placeholder\", settings.placeholder);\r\n            \r\n            if (typeof markdownTextarea.attr(\"name\") === \"undefined\" || markdownTextarea.attr(\"name\") === \"\")\r\n            {\r\n                markdownTextarea.attr(\"name\", (settings.name !== \"\") ? settings.name : id + \"-markdown-doc\");\r\n            }\r\n            \r\n            var appendElements = [\r\n                (!settings.readOnly) ? \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"preview-close-btn\\\"></a>\" : \"\",\r\n                ( (settings.saveHTMLToTextarea) ? \"<textarea class=\\\"\" + classNames.textarea.html + \"\\\" name=\\\"\" + id + \"-html-code\\\"></textarea>\" : \"\" ),\r\n                \"<div class=\\\"\" + classPrefix + \"preview\\\"><div class=\\\"markdown-body \" + classPrefix + \"preview-container\\\"></div></div>\",\r\n                \"<div class=\\\"\" + classPrefix + \"container-mask\\\" style=\\\"display:block;\\\"></div>\",\r\n                \"<div class=\\\"\" + classPrefix + \"mask\\\"></div>\"\r\n            ].join(\"\\n\");\r\n            \r\n            editor.append(appendElements).addClass(classPrefix + \"vertical\");\r\n            \r\n            if (settings.theme !== \"\") \r\n            {\r\n                editor.addClass(classPrefix + \"theme-\" + settings.theme);\r\n            }\r\n            \r\n            this.mask          = editor.children(\".\" + classPrefix + \"mask\");    \r\n            this.containerMask = editor.children(\".\" + classPrefix  + \"container-mask\");\r\n            \r\n            if (settings.markdown !== \"\")\r\n            {\r\n                markdownTextarea.val(settings.markdown);\r\n            }\r\n            \r\n            if (settings.appendMarkdown !== \"\")\r\n            {\r\n                markdownTextarea.val(markdownTextarea.val() + settings.appendMarkdown);\r\n            }\r\n            \r\n            this.htmlTextarea     = editor.children(\".\" + classNames.textarea.html);            \r\n            this.preview          = editor.children(\".\" + classPrefix + \"preview\");\r\n            this.previewContainer = this.preview.children(\".\" + classPrefix + \"preview-container\");\r\n            \r\n            if (settings.previewTheme !== \"\") \r\n            {\r\n                this.preview.addClass(classPrefix + \"preview-theme-\" + settings.previewTheme);\r\n            }\r\n            \r\n            if (typeof define === \"function\" && define.amd)\r\n            {\r\n                if (typeof katex !== \"undefined\") \r\n                {\r\n                    editormd.$katex = katex;\r\n                }\r\n                \r\n                if (settings.searchReplace && !settings.readOnly) \r\n                {\r\n                    editormd.loadCSS(settings.path + \"codemirror/addon/dialog/dialog\");\r\n                    editormd.loadCSS(settings.path + \"codemirror/addon/search/matchesonscrollbar\");\r\n                }\r\n            }\r\n            \r\n            if ((typeof define === \"function\" && define.amd) || !settings.autoLoadModules)\r\n            {\r\n                if (typeof CodeMirror !== \"undefined\") {\r\n                    editormd.$CodeMirror = CodeMirror;\r\n                }\r\n                \r\n                if (typeof marked     !== \"undefined\") {\r\n                    editormd.$marked     = marked;\r\n                }\r\n                \r\n                this.setCodeMirror().setToolbar().loadedDisplay();\r\n            } \r\n            else \r\n            {\r\n                this.loadQueues();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Required components loading queue\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        loadQueues : function() {\r\n            var _this        = this;\r\n            var settings     = this.settings;\r\n            var loadPath     = settings.path;\r\n                                \r\n            var loadFlowChartOrSequenceDiagram = function() {\r\n                \r\n                if (editormd.isIE8) \r\n                {\r\n                    _this.loadedDisplay();\r\n                    \r\n                    return ;\r\n                }\r\n\r\n                if (settings.flowChart || settings.sequenceDiagram) \r\n                {\r\n                    editormd.loadScript(loadPath + \"raphael.min\", function() {\r\n\r\n                        editormd.loadScript(loadPath + \"underscore.min\", function() {  \r\n\r\n                            if (!settings.flowChart && settings.sequenceDiagram) \r\n                            {\r\n                                editormd.loadScript(loadPath + \"sequence-diagram.min\", function() {\r\n                                    _this.loadedDisplay();\r\n                                });\r\n                            }\r\n                            else if (settings.flowChart && !settings.sequenceDiagram) \r\n                            {      \r\n                                editormd.loadScript(loadPath + \"flowchart.min\", function() {  \r\n                                    editormd.loadScript(loadPath + \"jquery.flowchart.min\", function() {\r\n                                        _this.loadedDisplay();\r\n                                    });\r\n                                });\r\n                            }\r\n                            else if (settings.flowChart && settings.sequenceDiagram) \r\n                            {  \r\n                                editormd.loadScript(loadPath + \"flowchart.min\", function() {  \r\n                                    editormd.loadScript(loadPath + \"jquery.flowchart.min\", function() {\r\n                                        editormd.loadScript(loadPath + \"sequence-diagram.min\", function() {\r\n                                            _this.loadedDisplay();\r\n                                        });\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                    });\r\n                } \r\n                else\r\n                {\r\n                    _this.loadedDisplay();\r\n                }\r\n            }; \r\n\r\n            editormd.loadCSS(loadPath + \"codemirror/codemirror.min\");\r\n            \r\n            if (settings.searchReplace && !settings.readOnly)\r\n            {\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/dialog/dialog\");\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/search/matchesonscrollbar\");\r\n            }\r\n            \r\n            if (settings.codeFold)\r\n            {\r\n                editormd.loadCSS(loadPath + \"codemirror/addon/fold/foldgutter\");            \r\n            }\r\n            \r\n            editormd.loadScript(loadPath + \"codemirror/codemirror.min\", function() {\r\n                editormd.$CodeMirror = CodeMirror;\r\n                \r\n                editormd.loadScript(loadPath + \"codemirror/modes.min\", function() {\r\n                    \r\n                    editormd.loadScript(loadPath + \"codemirror/addons.min\", function() {\r\n                        \r\n                        _this.setCodeMirror();\r\n                        \r\n                        if (settings.mode !== \"gfm\" && settings.mode !== \"markdown\") \r\n                        {\r\n                            _this.loadedDisplay();\r\n                            \r\n                            return false;\r\n                        }\r\n                        \r\n                        _this.setToolbar();\r\n\r\n                        editormd.loadScript(loadPath + \"marked.min\", function() {\r\n\r\n                            editormd.$marked = marked;\r\n                                \r\n                            if (settings.previewCodeHighlight) \r\n                            {\r\n                                editormd.loadScript(loadPath + \"prettify.min\", function() {\r\n                                    loadFlowChartOrSequenceDiagram();\r\n                                });\r\n                            } \r\n                            else\r\n                            {                  \r\n                                loadFlowChartOrSequenceDiagram();\r\n                            }\r\n                        });\r\n                        \r\n                    });\r\n                    \r\n                });\r\n                \r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         *  Editor.md \r\n         * Setting Editor.md theme\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setTheme : function(theme) {\r\n            var editor      = this.editor;\r\n            var oldTheme    = this.settings.theme;\r\n            var themePrefix = this.classPrefix + \"theme-\";\r\n            \r\n            editor.removeClass(themePrefix + oldTheme).addClass(themePrefix + theme);\r\n            \r\n            this.settings.theme = theme;\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         *  CodeMirror\r\n         * Setting CodeMirror (Editor area) theme\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setEditorTheme : function(theme) {  \r\n            var settings   = this.settings;  \r\n            settings.editorTheme = theme;  \r\n            \r\n            if (theme !== \"default\")\r\n            {\r\n                editormd.loadCSS(settings.path + \"codemirror/theme/\" + settings.editorTheme);\r\n            }\r\n            \r\n            this.cm.setOption(\"theme\", theme);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * setEditorTheme() \r\n         * setEditorTheme() alias\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setCodeMirrorTheme : function (theme) {            \r\n            this.setEditorTheme(theme);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         *  Editor.md \r\n         * Setting Editor.md theme\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setPreviewTheme : function(theme) {  \r\n            var preview     = this.preview;\r\n            var oldTheme    = this.settings.previewTheme;\r\n            var themePrefix = this.classPrefix + \"preview-theme-\";\r\n            \r\n            preview.removeClass(themePrefix + oldTheme).addClass(themePrefix + theme);\r\n            \r\n            this.settings.previewTheme = theme;\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * CodeMirror\r\n         * CodeMirror initialization\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setCodeMirror : function() { \r\n            var settings         = this.settings;\r\n            var editor           = this.editor;\r\n            \r\n            if (settings.editorTheme !== \"default\")\r\n            {\r\n                editormd.loadCSS(settings.path + \"codemirror/theme/\" + settings.editorTheme);\r\n            }\r\n            \r\n            var codeMirrorConfig = {\r\n                mode                      : settings.mode,\r\n                theme                     : settings.editorTheme,\r\n                tabSize                   : settings.tabSize,\r\n                dragDrop                  : false,\r\n                autofocus                 : settings.autoFocus,\r\n                autoCloseTags             : settings.autoCloseTags,\r\n                readOnly                  : (settings.readOnly) ? \"nocursor\" : false,\r\n                indentUnit                : settings.indentUnit,\r\n                lineNumbers               : settings.lineNumbers,\r\n                lineWrapping              : settings.lineWrapping,\r\n                extraKeys                 : {\r\n                                                \"Ctrl-Q\": function(cm) { \r\n                                                    cm.foldCode(cm.getCursor()); \r\n                                                }\r\n                                            },\r\n                foldGutter                : settings.codeFold,\r\n                gutters                   : [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\r\n                matchBrackets             : settings.matchBrackets,\r\n                indentWithTabs            : settings.indentWithTabs,\r\n                styleActiveLine           : settings.styleActiveLine,\r\n                styleSelectedText         : settings.styleSelectedText,\r\n                autoCloseBrackets         : settings.autoCloseBrackets,\r\n                showTrailingSpace         : settings.showTrailingSpace,\r\n                highlightSelectionMatches : ( (!settings.matchWordHighlight) ? false : { showToken: (settings.matchWordHighlight === \"onselected\") ? false : /\\w/ } )\r\n            };\r\n            \r\n            this.codeEditor = this.cm        = editormd.$CodeMirror.fromTextArea(this.markdownTextarea[0], codeMirrorConfig);\r\n            this.codeMirror = this.cmElement = editor.children(\".CodeMirror\");\r\n            \r\n            if (settings.value !== \"\")\r\n            {\r\n                this.cm.setValue(settings.value);\r\n            }\r\n\r\n            this.codeMirror.css({\r\n                fontSize : settings.fontSize,\r\n                width    : (!settings.watch) ? \"100%\" : \"50%\"\r\n            });\r\n            \r\n            if (settings.autoHeight)\r\n            {\r\n                this.codeMirror.css(\"height\", \"auto\");\r\n                this.cm.setOption(\"viewportMargin\", Infinity);\r\n            }\r\n            \r\n            if (!settings.lineNumbers)\r\n            {\r\n                this.codeMirror.find(\".CodeMirror-gutters\").css(\"border-right\", \"none\");\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * CodeMirror\r\n         * Get CodeMirror setting options\r\n         * \r\n         * @returns {Mixed}                  return CodeMirror setting option value\r\n         */\r\n        \r\n        getCodeMirrorOption : function(key) {            \r\n            return this.cm.getOption(key);\r\n        },\r\n        \r\n        /**\r\n         * CodeMirror\r\n         * CodeMirror setting options / resettings\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setCodeMirrorOption : function(key, value) {\r\n            \r\n            this.cm.setOption(key, value);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         *  CodeMirror \r\n         * Add CodeMirror keyboard shortcuts key map\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        addKeyMap : function(map, bottom) {\r\n            this.cm.addKeyMap(map, bottom);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         *  CodeMirror \r\n         * Remove CodeMirror keyboard shortcuts key map\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        removeKeyMap : function(map) {\r\n            this.cm.removeKeyMap(map);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Goto CodeMirror line\r\n         * \r\n         * @param   {String|Intiger}   line      line number or \"first\"|\"last\"\r\n         * @returns {editormd}                   editormd\r\n         */\r\n        \r\n        gotoLine : function (line) {\r\n            \r\n            var settings = this.settings;\r\n            \r\n            if (!settings.gotoLine)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            var cm       = this.cm;\r\n            var editor   = this.editor;\r\n            var count    = cm.lineCount();\r\n            var preview  = this.preview;\r\n            \r\n            if (typeof line === \"string\")\r\n            {\r\n                if(line === \"last\")\r\n                {\r\n                    line = count;\r\n                }\r\n            \r\n                if (line === \"first\")\r\n                {\r\n                    line = 1;\r\n                }\r\n            }\r\n            \r\n            if (typeof line !== \"number\") \r\n            {  \r\n                alert(\"Error: The line number must be an integer.\");\r\n                return this;\r\n            }\r\n            \r\n            line  = parseInt(line) - 1;\r\n            \r\n            if (line > count)\r\n            {\r\n                alert(\"Error: The line number range 1-\" + count);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            cm.setCursor( {line : line, ch : 0} );\r\n            \r\n            var scrollInfo   = cm.getScrollInfo();\r\n            var clientHeight = scrollInfo.clientHeight; \r\n            var coords       = cm.charCoords({line : line, ch : 0}, \"local\");\r\n            \r\n            cm.scrollTo(null, (coords.top + coords.bottom - clientHeight) / 2);\r\n            \r\n            if (settings.watch)\r\n            {            \r\n                var cmScroll  = this.codeMirror.find(\".CodeMirror-scroll\")[0];\r\n                var height    = $(cmScroll).height(); \r\n                var scrollTop = cmScroll.scrollTop;         \r\n                var percent   = (scrollTop / cmScroll.scrollHeight);\r\n\r\n                if (scrollTop === 0)\r\n                {\r\n                    preview.scrollTop(0);\r\n                } \r\n                else if (scrollTop + height >= cmScroll.scrollHeight - 16)\r\n                { \r\n                    preview.scrollTop(preview[0].scrollHeight);                    \r\n                } \r\n                else\r\n                {                    \r\n                    preview.scrollTop(preview[0].scrollHeight * percent);\r\n                }\r\n            }\r\n\r\n            cm.focus();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Extend editormd instance object, can mutil setting.\r\n         * \r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        extend : function() {\r\n            if (typeof arguments[1] !== \"undefined\")\r\n            {\r\n                if (typeof arguments[1] === \"function\")\r\n                {\r\n                    arguments[1] = $.proxy(arguments[1], this);\r\n                }\r\n\r\n                this[arguments[0]] = arguments[1];\r\n            }\r\n            \r\n            if (typeof arguments[0] === \"object\" && typeof arguments[0].length === \"undefined\")\r\n            {\r\n                $.extend(true, this, arguments[0]);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Extend editormd instance object, one by one\r\n         * \r\n         * @param   {String|Object}   key       option key\r\n         * @param   {String|Object}   value     option value\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        set : function (key, value) {\r\n            \r\n            if (typeof value !== \"undefined\" && typeof value === \"function\")\r\n            {\r\n                value = $.proxy(value, this);\r\n            }\r\n            \r\n            this[key] = value;\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Resetting editor options\r\n         * \r\n         * @param   {String|Object}   key       option key\r\n         * @param   {String|Object}   value     option value\r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        config : function(key, value) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof key === \"object\")\r\n            {\r\n                settings = $.extend(true, settings, key);\r\n            }\r\n            \r\n            if (typeof key === \"string\")\r\n            {\r\n                settings[key] = value;\r\n            }\r\n            \r\n            this.settings = settings;\r\n            this.recreate();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Bind editor event handle\r\n         * \r\n         * @param   {String}     eventType      event type\r\n         * @param   {Function}   callback       \r\n         * @returns {editormd}                  this(editormd instance object.)\r\n         */\r\n        \r\n        on : function(eventType, callback) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof settings[\"on\" + eventType] !== \"undefined\") \r\n            {                \r\n                settings[\"on\" + eventType] = $.proxy(callback, this);      \r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Unbind editor event handle\r\n         * \r\n         * @param   {String}   eventType          event type\r\n         * @returns {editormd}                    this(editormd instance object.)\r\n         */\r\n        \r\n        off : function(eventType) {\r\n            var settings = this.settings;\r\n            \r\n            if (typeof settings[\"on\" + eventType] !== \"undefined\") \r\n            {\r\n                settings[\"on\" + eventType] = function(){};\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Display toolbar\r\n         * \r\n         * @param   {Function} [callback=function(){}] \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        showToolbar : function(callback) {\r\n            var settings = this.settings;\r\n            \r\n            if(settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            if (settings.toolbar && (this.toolbar.length < 1 || this.toolbar.find(\".\" + this.classPrefix + \"menu\").html() === \"\") )\r\n            {\r\n                this.setToolbar();\r\n            }\r\n            \r\n            settings.toolbar = true; \r\n            \r\n            this.toolbar.show();\r\n            this.resize();\r\n            \r\n            $.proxy(callback || function(){}, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Hide toolbar\r\n         * \r\n         * @param   {Function} [callback=function(){}] \r\n         * @returns {editormd}                         this(editormd instance object.)\r\n         */\r\n        \r\n        hideToolbar : function(callback) { \r\n            var settings = this.settings;\r\n            \r\n            settings.toolbar = false;  \r\n            this.toolbar.hide();\r\n            this.resize();\r\n            \r\n            $.proxy(callback || function(){}, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set toolbar in window scroll auto fixed position\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setToolbarAutoFixed : function(fixed) {\r\n            \r\n            var state    = this.state;\r\n            var editor   = this.editor;\r\n            var toolbar  = this.toolbar;\r\n            var settings = this.settings;\r\n            \r\n            if (typeof fixed !== \"undefined\")\r\n            {\r\n                settings.toolbarAutoFixed = fixed;\r\n            }\r\n            \r\n            var autoFixedHandle = function(){\r\n                var $window = $(window);\r\n                var top     = $window.scrollTop();\r\n                \r\n                if (!settings.toolbarAutoFixed)\r\n                {\r\n                    return false;\r\n                }\r\n\r\n                if (top - editor.offset().top > 10 && top < editor.height())\r\n                {\r\n                    toolbar.css({\r\n                        position : \"fixed\",\r\n                        width    : editor.width() + \"px\",\r\n                        left     : ($window.width() - editor.width()) / 2 + \"px\"\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    toolbar.css({\r\n                        position : \"absolute\",\r\n                        width    : \"100%\",\r\n                        left     : 0\r\n                    });\r\n                }\r\n            };\r\n            \r\n            if (!state.fullscreen && !state.preview && settings.toolbar && settings.toolbarAutoFixed)\r\n            {\r\n                $(window).bind(\"scroll\", autoFixedHandle);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set toolbar and Initialization\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setToolbar : function() {\r\n            var settings    = this.settings;  \r\n            \r\n            if(settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            var editor      = this.editor;\r\n            var preview     = this.preview;\r\n            var classPrefix = this.classPrefix;\r\n            \r\n            var toolbar     = this.toolbar = editor.children(\".\" + classPrefix + \"toolbar\");\r\n            \r\n            if (settings.toolbar && toolbar.length < 1)\r\n            {            \r\n                var toolbarHTML = \"<div class=\\\"\" + classPrefix + \"toolbar\\\"><div class=\\\"\" + classPrefix + \"toolbar-container\\\"><ul class=\\\"\" + classPrefix + \"menu\\\"></ul></div></div>\";\r\n                \r\n                editor.append(toolbarHTML);\r\n                toolbar = this.toolbar = editor.children(\".\" + classPrefix + \"toolbar\");\r\n            }\r\n            \r\n            if (!settings.toolbar) \r\n            {\r\n                toolbar.hide();\r\n                \r\n                return this;\r\n            }\r\n            \r\n            toolbar.show();\r\n            \r\n            var icons       = (typeof settings.toolbarIcons === \"function\") ? settings.toolbarIcons() \r\n                            : ((typeof settings.toolbarIcons === \"string\")  ? editormd.toolbarModes[settings.toolbarIcons] : settings.toolbarIcons);\r\n            \r\n            var toolbarMenu = toolbar.find(\".\" + this.classPrefix + \"menu\"), menu = \"\";\r\n            var pullRight   = false;\r\n            \r\n            for (var i = 0, len = icons.length; i < len; i++)\r\n            {\r\n                var name = icons[i];\r\n\r\n                if (name === \"||\") \r\n                { \r\n                    pullRight = true;\r\n                } \r\n                else if (name === \"|\")\r\n                {\r\n                    menu += \"<li class=\\\"divider\\\" unselectable=\\\"on\\\">|</li>\";\r\n                }\r\n                else\r\n                {\r\n                    var isHeader = (/h(\\d)/.test(name));\r\n                    var index    = name;\r\n                    \r\n                    if (name === \"watch\" && !settings.watch) {\r\n                        index = \"unwatch\";\r\n                    }\r\n                    \r\n                    var title     = settings.lang.toolbar[index];\r\n                    var iconTexts = settings.toolbarIconTexts[index];\r\n                    var iconClass = settings.toolbarIconsClass[index];\r\n                    \r\n                    title     = (typeof title     === \"undefined\") ? \"\" : title;\r\n                    iconTexts = (typeof iconTexts === \"undefined\") ? \"\" : iconTexts;\r\n                    iconClass = (typeof iconClass === \"undefined\") ? \"\" : iconClass;\r\n\r\n                    var menuItem = pullRight ? \"<li class=\\\"pull-right\\\">\" : \"<li>\";\r\n                    \r\n                    if (typeof settings.toolbarCustomIcons[name] !== \"undefined\" && typeof settings.toolbarCustomIcons[name] !== \"function\")\r\n                    {\r\n                        menuItem += settings.toolbarCustomIcons[name];\r\n                    }\r\n                    else \r\n                    {\r\n                        menuItem += \"<a href=\\\"javascript:;\\\" title=\\\"\" + title + \"\\\" unselectable=\\\"on\\\">\";\r\n                        menuItem += \"<i class=\\\"fa \" + iconClass + \"\\\" name=\\\"\"+name+\"\\\" unselectable=\\\"on\\\">\"+((isHeader) ? name.toUpperCase() : ( (iconClass === \"\") ? iconTexts : \"\") ) + \"</i>\";\r\n                        menuItem += \"</a>\";\r\n                    }\r\n\r\n                    menuItem += \"</li>\";\r\n\r\n                    menu = pullRight ? menuItem + menu : menu + menuItem;\r\n                }\r\n            }\r\n\r\n            toolbarMenu.html(menu);\r\n            \r\n            toolbarMenu.find(\"[title=\\\"Lowercase\\\"]\").attr(\"title\", settings.lang.toolbar.lowercase);\r\n            toolbarMenu.find(\"[title=\\\"ucwords\\\"]\").attr(\"title\", settings.lang.toolbar.ucwords);\r\n            \r\n            this.setToolbarHandler();\r\n            this.setToolbarAutoFixed();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Get toolbar icons event handlers\r\n         * \r\n         * @param   {Object}   cm    CodeMirror\r\n         * @param   {String}   name  \r\n         * @returns {Object}         \r\n         */\r\n            \r\n        dialogLockScreen : function() {\r\n            $.proxy(editormd.dialogLockScreen, this)();\r\n            \r\n            return this;\r\n        },\r\n\r\n        dialogShowMask : function(dialog) {\r\n            $.proxy(editormd.dialogShowMask, this)(dialog);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        getToolbarHandles : function(name) {  \r\n            var toolbarHandlers = this.toolbarHandlers = editormd.toolbarHandlers;\r\n            \r\n            return (name && typeof toolbarIconHandlers[name] !== \"undefined\") ? toolbarHandlers[name] : toolbarHandlers;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Bind toolbar icons event handle\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        setToolbarHandler : function() {\r\n            var _this               = this;\r\n            var settings            = this.settings;\r\n            \r\n            if (!settings.toolbar || settings.readOnly) {\r\n                return this;\r\n            }\r\n            \r\n            var toolbar             = this.toolbar;\r\n            var cm                  = this.cm;\r\n            var classPrefix         = this.classPrefix;           \r\n            var toolbarIcons        = this.toolbarIcons = toolbar.find(\".\" + classPrefix + \"menu > li > a\");  \r\n            var toolbarIconHandlers = this.getToolbarHandles();  \r\n                \r\n            toolbarIcons.bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function(event) {\r\n\r\n                var icon                = $(this).children(\".fa\");\r\n                var name                = icon.attr(\"name\");\r\n                var cursor              = cm.getCursor();\r\n                var selection           = cm.getSelection();\r\n\r\n                if (name === \"\") {\r\n                    return ;\r\n                }\r\n                \r\n                _this.activeIcon = icon;\r\n\r\n                if (typeof toolbarIconHandlers[name] !== \"undefined\") \r\n                {\r\n                    $.proxy(toolbarIconHandlers[name], _this)(cm);\r\n                }\r\n                else \r\n                {\r\n                    if (typeof settings.toolbarHandlers[name] !== \"undefined\") \r\n                    {\r\n                        $.proxy(settings.toolbarHandlers[name], _this)(cm, icon, cursor, selection);\r\n                    }\r\n                }\r\n                \r\n                if (name !== \"link\" && name !== \"reference-link\" && name !== \"image\" && name !== \"code-block\" && \r\n                    name !== \"preformatted-text\" && name !== \"watch\" && name !== \"preview\" && name !== \"search\" && name !== \"fullscreen\" && name !== \"info\") \r\n                {\r\n                    cm.focus();\r\n                }\r\n\r\n                return false;\r\n\r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Creating custom dialogs\r\n         * \r\n         * @param   {Object} options   Key/Value\r\n         * @returns {dialog}          dialogjQuery\r\n         */\r\n        \r\n        createDialog : function(options) {            \r\n            return $.proxy(editormd.createDialog, this)(options);\r\n        },\r\n        \r\n        /**\r\n         * Editor.md\r\n         * Create about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        createInfoDialog : function() {\r\n            var _this        = this;\r\n\t\t\tvar editor       = this.editor;\r\n            var classPrefix  = this.classPrefix;  \r\n            \r\n            var infoDialogHTML = [\r\n                \"<div class=\\\"\" + classPrefix + \"dialog \" + classPrefix + \"dialog-info\\\" style=\\\"\\\">\",\r\n                \"<div class=\\\"\" + classPrefix + \"dialog-container\\\">\",\r\n                \"<h1><i class=\\\"editormd-logo editormd-logo-lg editormd-logo-color\\\"></i> \" + editormd.title + \"<small>v\" + editormd.version + \"</small></h1>\",\r\n                \"<p>\" + this.lang.description + \"</p>\",\r\n                \"<p style=\\\"margin: 10px 0 20px 0;\\\"><a href=\\\"\" + editormd.homePage + \"\\\" target=\\\"_blank\\\">\" + editormd.homePage + \" <i class=\\\"fa fa-external-link\\\"></i></a></p>\",\r\n                \"<p style=\\\"font-size: 0.85em;\\\">Copyright &copy; 2015 <a href=\\\"https://github.com/pandao\\\" target=\\\"_blank\\\" class=\\\"hover-link\\\">Pandao</a>, The <a href=\\\"https://github.com/pandao/editor.md/blob/master/LICENSE\\\" target=\\\"_blank\\\" class=\\\"hover-link\\\">MIT</a> License.</p>\",\r\n                \"</div>\",\r\n                \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"dialog-close\\\"></a>\",\r\n                \"</div>\"\r\n            ].join(\"\\n\");\r\n\r\n            editor.append(infoDialogHTML);\r\n            \r\n            var infoDialog  = this.infoDialog = editor.children(\".\" + classPrefix + \"dialog-info\");\r\n\r\n            infoDialog.find(\".\" + classPrefix + \"dialog-close\").bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function() {\r\n                _this.hideInfoDialog();\r\n            });\r\n            \r\n            infoDialog.css(\"border\", (editormd.isIE8) ? \"1px solid #ddd\" : \"\").css(\"z-index\", editormd.dialogZindex).show();\r\n            \r\n            this.infoDialogPosition();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * Editor.md\r\n         * Editor.md dialog position handle\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        infoDialogPosition : function() {\r\n            var infoDialog = this.infoDialog;\r\n            \r\n\t\t\tvar _infoDialogPosition = function() {\r\n\t\t\t\tinfoDialog.css({\r\n\t\t\t\t\ttop  : ($(window).height() - infoDialog.height()) / 2 + \"px\",\r\n\t\t\t\t\tleft : ($(window).width()  - infoDialog.width()) / 2  + \"px\"\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t_infoDialogPosition();\r\n\r\n\t\t\t$(window).resize(_infoDialogPosition);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * Editor.md\r\n         * Display about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        showInfoDialog : function() {\r\n\r\n            $(\"html,body\").css(\"overflow-x\", \"hidden\");\r\n            \r\n            var _this       = this;\r\n\t\t\tvar editor      = this.editor;\r\n            var settings    = this.settings;         \r\n\t\t\tvar infoDialog  = this.infoDialog = editor.children(\".\" + this.classPrefix + \"dialog-info\");\r\n            \r\n            if (infoDialog.length < 1)\r\n            {\r\n                this.createInfoDialog();\r\n            }\r\n            \r\n            this.lockScreen(true);\r\n            \r\n            this.mask.css({\r\n\t\t\t\t\t\topacity         : settings.dialogMaskOpacity,\r\n\t\t\t\t\t\tbackgroundColor : settings.dialogMaskBgColor\r\n\t\t\t\t\t}).show();\r\n\r\n\t\t\tinfoDialog.css(\"z-index\", editormd.dialogZindex).show();\r\n\r\n\t\t\tthis.infoDialogPosition();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * Editor.md\r\n         * Hide about Editor.md dialog\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        hideInfoDialog : function() {            \r\n            $(\"html,body\").css(\"overflow-x\", \"\");\r\n            this.infoDialog.hide();\r\n            this.mask.hide();\r\n            this.lockScreen(false);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * lock screen\r\n         * \r\n         * @param   {Boolean}    lock    Boolean \r\n         * @returns {editormd}           editormd\r\n         */\r\n        \r\n        lockScreen : function(lock) {\r\n            editormd.lockScreen(lock);\r\n            this.resize();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Recreate editor\r\n         * \r\n         * @returns {editormd}  editormd\r\n         */\r\n        \r\n        recreate : function() {\r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var settings         = this.settings;\r\n            \r\n            this.codeMirror.remove();\r\n            \r\n            this.setCodeMirror();\r\n\r\n            if (!settings.readOnly) \r\n            {\r\n                if (editor.find(\".editormd-dialog\").length > 0) {\r\n                    editor.find(\".editormd-dialog\").remove();\r\n                }\r\n                \r\n                if (settings.toolbar) \r\n                {  \r\n                    this.getToolbarHandles();                  \r\n                    this.setToolbar();\r\n                }\r\n            }\r\n            \r\n            this.loadedDisplay(true);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * HTMLpre\r\n         * highlight of preview codes\r\n         * \r\n         * @returns {editormd}             editormd\r\n         */\r\n        \r\n        previewCodeHighlight : function() {    \r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if (settings.previewCodeHighlight) \r\n            {\r\n                previewContainer.find(\"pre\").addClass(\"prettyprint linenums\");\r\n                \r\n                if (typeof prettyPrint !== \"undefined\")\r\n                {                    \r\n                    prettyPrint();\r\n                }\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * TeX(KaTeX)\r\n         * TeX(KaTeX) Renderer\r\n         * \r\n         * @returns {editormd}             editormd\r\n         */\r\n        \r\n        katexRender : function() {\r\n            \r\n            if (timer === null)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            this.previewContainer.find(\".\" + editormd.classNames.tex).each(function(){\r\n                var tex  = $(this);\r\n                editormd.$katex.render(tex.text(), tex[0]);\r\n                \r\n                tex.find(\".katex\").css(\"font-size\", \"1.6em\");\r\n            });   \r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * FlowChart and SequenceDiagram Renderer\r\n         * \r\n         * @returns {editormd}             editormd\r\n         */\r\n        \r\n        flowChartAndSequenceDiagramRender : function() {\r\n            var $this            = this;\r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if (editormd.isIE8) {\r\n                return this;\r\n            }\r\n\r\n            if (settings.flowChart) {\r\n                if (flowchartTimer === null) {\r\n                    return this;\r\n                }\r\n                \r\n                previewContainer.find(\".flowchart\").flowChart(); \r\n            }\r\n\r\n            if (settings.sequenceDiagram) {\r\n                previewContainer.find(\".sequence-diagram\").sequenceDiagram({theme: \"simple\"});\r\n            }\r\n                    \r\n            var preview    = $this.preview;\r\n            var codeMirror = $this.codeMirror;\r\n            var codeView   = codeMirror.find(\".CodeMirror-scroll\");\r\n\r\n            var height    = codeView.height();\r\n            var scrollTop = codeView.scrollTop();                    \r\n            var percent   = (scrollTop / codeView[0].scrollHeight);\r\n            var tocHeight = 0;\r\n\r\n            preview.find(\".markdown-toc-list\").each(function(){\r\n                tocHeight += $(this).height();\r\n            });\r\n\r\n            var tocMenuHeight = preview.find(\".editormd-toc-menu\").height(); \r\n            tocMenuHeight = (!tocMenuHeight) ? 0 : tocMenuHeight;\r\n\r\n            if (scrollTop === 0) \r\n            {\r\n                preview.scrollTop(0);\r\n            } \r\n            else if (scrollTop + height >= codeView[0].scrollHeight - 16)\r\n            { \r\n                preview.scrollTop(preview[0].scrollHeight);                        \r\n            } \r\n            else\r\n            {                  \r\n                preview.scrollTop((preview[0].scrollHeight + tocHeight + tocMenuHeight) * percent);\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Register CodeMirror keyMaps (keyboard shortcuts).\r\n         * \r\n         * @param   {Object}    keyMap      KeyMap key/value {\"(Ctrl/Shift/Alt)-Key\" : function(){}}\r\n         * @returns {editormd}              return this\r\n         */\r\n        \r\n        registerKeyMaps : function(keyMap) {\r\n            \r\n            var _this           = this;\r\n            var cm              = this.cm;\r\n            var settings        = this.settings;\r\n            var toolbarHandlers = editormd.toolbarHandlers;\r\n            var disabledKeyMaps = settings.disabledKeyMaps;\r\n            \r\n            keyMap              = keyMap || null;\r\n            \r\n            if (keyMap)\r\n            {\r\n                for (var i in keyMap)\r\n                {\r\n                    if ($.inArray(i, disabledKeyMaps) < 0)\r\n                    {\r\n                        var map = {};\r\n                        map[i]  = keyMap[i];\r\n\r\n                        cm.addKeyMap(keyMap);\r\n                    }\r\n                }\r\n            }\r\n            else\r\n            {\r\n                for (var k in editormd.keyMaps)\r\n                {\r\n                    var _keyMap = editormd.keyMaps[k];\r\n                    var handle = (typeof _keyMap === \"string\") ? $.proxy(toolbarHandlers[_keyMap], _this) : $.proxy(_keyMap, _this);\r\n                    \r\n                    if ($.inArray(k, [\"F9\", \"F10\", \"F11\"]) < 0 && $.inArray(k, disabledKeyMaps) < 0)\r\n                    {\r\n                        var _map = {};\r\n                        _map[k] = handle;\r\n\r\n                        cm.addKeyMap(_map);\r\n                    }\r\n                }\r\n                \r\n                $(window).keydown(function(event) {\r\n                    \r\n                    var keymaps = {\r\n                        \"120\" : \"F9\",\r\n                        \"121\" : \"F10\",\r\n                        \"122\" : \"F11\"\r\n                    };\r\n                    \r\n                    if ( $.inArray(keymaps[event.keyCode], disabledKeyMaps) < 0 )\r\n                    {\r\n                        switch (event.keyCode)\r\n                        {\r\n                            case 120:\r\n                                    $.proxy(toolbarHandlers[\"watch\"], _this)();\r\n                                    return false;\r\n                                break;\r\n                                \r\n                            case 121:\r\n                                    $.proxy(toolbarHandlers[\"preview\"], _this)();\r\n                                    return false;\r\n                                break;\r\n                                \r\n                            case 122:\r\n                                    $.proxy(toolbarHandlers[\"fullscreen\"], _this)();                        \r\n                                    return false;\r\n                                break;\r\n                                \r\n                            default:\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * \r\n         * @returns {editormd} return this\r\n         */\r\n        \r\n        bindScrollEvent : function() {\r\n            \r\n            var _this            = this;\r\n            var preview          = this.preview;\r\n            var settings         = this.settings;\r\n            var codeMirror       = this.codeMirror;\r\n            var mouseOrTouch     = editormd.mouseOrTouch;\r\n            \r\n            if (!settings.syncScrolling) {\r\n                return this;\r\n            }\r\n                \r\n            var cmBindScroll = function() {    \r\n                codeMirror.find(\".CodeMirror-scroll\").bind(mouseOrTouch(\"scroll\", \"touchmove\"), function(event) {\r\n                    var height    = $(this).height();\r\n                    var scrollTop = $(this).scrollTop();                    \r\n                    var percent   = (scrollTop / $(this)[0].scrollHeight);\r\n                    \r\n                    var tocHeight = 0;\r\n                    \r\n                    preview.find(\".markdown-toc-list\").each(function(){\r\n                        tocHeight += $(this).height();\r\n                    });\r\n                    \r\n                    var tocMenuHeight = preview.find(\".editormd-toc-menu\").height();\r\n                    tocMenuHeight = (!tocMenuHeight) ? 0 : tocMenuHeight;\r\n\r\n                    if (scrollTop === 0) \r\n                    {\r\n                        preview.scrollTop(0);\r\n                    } \r\n                    else if (scrollTop + height >= $(this)[0].scrollHeight - 16)\r\n                    { \r\n                        preview.scrollTop(preview[0].scrollHeight);                        \r\n                    } \r\n                    else\r\n                    {\r\n                        preview.scrollTop((preview[0].scrollHeight  + tocHeight + tocMenuHeight) * percent);\r\n                    }\r\n                    \r\n                    $.proxy(settings.onscroll, _this)(event);\r\n                });\r\n            };\r\n\r\n            var cmUnbindScroll = function() {\r\n                codeMirror.find(\".CodeMirror-scroll\").unbind(mouseOrTouch(\"scroll\", \"touchmove\"));\r\n            };\r\n\r\n            var previewBindScroll = function() {\r\n                \r\n                preview.bind(mouseOrTouch(\"scroll\", \"touchmove\"), function(event) {\r\n                    var height    = $(this).height();\r\n                    var scrollTop = $(this).scrollTop();         \r\n                    var percent   = (scrollTop / $(this)[0].scrollHeight);\r\n                    var codeView  = codeMirror.find(\".CodeMirror-scroll\");\r\n\r\n                    if(scrollTop === 0) \r\n                    {\r\n                        codeView.scrollTop(0);\r\n                    }\r\n                    else if (scrollTop + height >= $(this)[0].scrollHeight)\r\n                    {\r\n                        codeView.scrollTop(codeView[0].scrollHeight);                        \r\n                    }\r\n                    else \r\n                    {\r\n                        codeView.scrollTop(codeView[0].scrollHeight * percent);\r\n                    }\r\n                    \r\n                    $.proxy(settings.onpreviewscroll, _this)(event);\r\n                });\r\n\r\n            };\r\n\r\n            var previewUnbindScroll = function() {\r\n                preview.unbind(mouseOrTouch(\"scroll\", \"touchmove\"));\r\n            }; \r\n\r\n\t\t\tcodeMirror.bind({\r\n\t\t\t\tmouseover  : cmBindScroll,\r\n\t\t\t\tmouseout   : cmUnbindScroll,\r\n\t\t\t\ttouchstart : cmBindScroll,\r\n\t\t\t\ttouchend   : cmUnbindScroll\r\n\t\t\t});\r\n            \r\n            if (settings.syncScrolling === \"single\") {\r\n                return this;\r\n            }\r\n            \r\n\t\t\tpreview.bind({\r\n\t\t\t\tmouseover  : previewBindScroll,\r\n\t\t\t\tmouseout   : previewUnbindScroll,\r\n\t\t\t\ttouchstart : previewBindScroll,\r\n\t\t\t\ttouchend   : previewUnbindScroll\r\n\t\t\t});\r\n\r\n            return this;\r\n        },\r\n        \r\n        bindChangeEvent : function() {\r\n            \r\n            var _this            = this;\r\n            var cm               = this.cm;\r\n            var settings         = this.settings;\r\n            \r\n            if (!settings.syncScrolling) {\r\n                return this;\r\n            }\r\n            \r\n            cm.on(\"change\", function(_cm, changeObj) {\r\n                \r\n                if (settings.watch)\r\n                {\r\n                    _this.previewContainer.css(\"padding\", settings.autoHeight ? \"20px 20px 50px 40px\" : \"20px\");\r\n                }\r\n                \r\n                timer = setTimeout(function() {\r\n                    clearTimeout(timer);\r\n                    _this.save();\r\n                    timer = null;\r\n                }, settings.delay);\r\n            });\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Display handle of the module queues loaded after.\r\n         * \r\n         * @param   {Boolean}   recreate   \r\n         * @returns {editormd}             editormd\r\n         */\r\n        \r\n        loadedDisplay : function(recreate) {\r\n            \r\n            recreate             = recreate || false;\r\n            \r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var settings         = this.settings;\r\n            \r\n            this.containerMask.hide();\r\n            \r\n            this.save();\r\n            \r\n            if (settings.watch) {\r\n                preview.show();\r\n            }\r\n            \r\n            editor.data(\"oldWidth\", editor.width()).data(\"oldHeight\", editor.height()); // Zepto\r\n            \r\n            this.resize();\r\n            this.registerKeyMaps();\r\n            \r\n            $(window).resize(function(){\r\n                _this.resize();\r\n            });\r\n            \r\n            this.bindScrollEvent().bindChangeEvent();\r\n            \r\n            if (!recreate)\r\n            {\r\n                $.proxy(settings.onload, this)();\r\n            }\r\n            \r\n            this.state.loaded = true;\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set editor width\r\n         * \r\n         * @param   {Number|String} width  \r\n         * @returns {editormd}             editormd\r\n         */\r\n        \r\n        width : function(width) {\r\n                \r\n            this.editor.css(\"width\", (typeof width === \"number\") ? width  + \"px\" : width);            \r\n            this.resize();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set editor height\r\n         * \r\n         * @param   {Number|String} height  \r\n         * @returns {editormd}              editormd\r\n         */\r\n        \r\n        height : function(height) {\r\n                \r\n            this.editor.css(\"height\", (typeof height === \"number\")  ? height  + \"px\" : height);            \r\n            this.resize();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Resize editor layout\r\n         * \r\n         * @param   {Number|String} [width=null]  \r\n         * @param   {Number|String} [height=null] \r\n         * @returns {editormd}                    editormd\r\n         */\r\n        \r\n        resize : function(width, height) {\r\n            \r\n            width  = width  || null;\r\n            height = height || null;\r\n            \r\n            var state      = this.state;\r\n            var editor     = this.editor;\r\n            var preview    = this.preview;\r\n            var toolbar    = this.toolbar;\r\n            var settings   = this.settings;\r\n            var codeMirror = this.codeMirror;\r\n            \r\n            if (width)\r\n            {\r\n                editor.css(\"width\", (typeof width  === \"number\") ? width  + \"px\" : width);\r\n            }\r\n            \r\n            if (settings.autoHeight && !state.fullscreen && !state.preview)\r\n            {\r\n                editor.css(\"height\", \"auto\");\r\n                codeMirror.css(\"height\", \"auto\");\r\n            } \r\n            else \r\n            {\r\n                if (height) \r\n                {\r\n                    editor.css(\"height\", (typeof height === \"number\") ? height + \"px\" : height);\r\n                }\r\n                \r\n                if (state.fullscreen)\r\n                {\r\n                    editor.height($(window).height());\r\n                }\r\n\r\n                if (settings.toolbar && !settings.readOnly) \r\n                {\r\n                    codeMirror.css(\"margin-top\", toolbar.height() + 1).height(editor.height() - toolbar.height());\r\n                } \r\n                else\r\n                {\r\n                    codeMirror.css(\"margin-top\", 0).height(editor.height());\r\n                }\r\n            }\r\n            \r\n            if(settings.watch) \r\n            {\r\n                codeMirror.width(editor.width() / 2);\r\n                preview.width((!state.preview) ? editor.width() / 2 : editor.width());\r\n                \r\n                this.previewContainer.css(\"padding\", settings.autoHeight ? \"20px 20px 50px 40px\" : \"20px\");\r\n                \r\n                if (settings.toolbar && !settings.readOnly) \r\n                {\r\n                    preview.css(\"top\", toolbar.height() + 1);\r\n                } \r\n                else \r\n                {\r\n                    preview.css(\"top\", 0);\r\n                }\r\n                \r\n                if (settings.autoHeight && !state.fullscreen && !state.preview)\r\n                {\r\n                    preview.height(\"\");\r\n                }\r\n                else\r\n                {                \r\n                    var previewHeight = (settings.toolbar && !settings.readOnly) ? editor.height() - toolbar.height() : editor.height();\r\n                    \r\n                    preview.height(previewHeight);\r\n                }\r\n            } \r\n            else \r\n            {\r\n                codeMirror.width(editor.width());\r\n                preview.hide();\r\n            }\r\n            \r\n            if (state.loaded) \r\n            {\r\n                $.proxy(settings.onresize, this)();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * Markdown\r\n         * Parse & Saving Markdown source code\r\n         * \r\n         * @returns {editormd}     editormd\r\n         */\r\n        \r\n        save : function() {\r\n            \r\n            if (timer === null)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            var _this            = this;\r\n            var state            = this.state;\r\n            var settings         = this.settings;\r\n            var cm               = this.cm;            \r\n            var cmValue          = cm.getValue();\r\n            var previewContainer = this.previewContainer;\r\n\r\n            if (settings.mode !== \"gfm\" && settings.mode !== \"markdown\") \r\n            {\r\n                this.markdownTextarea.val(cmValue);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            var marked          = editormd.$marked;\r\n            var markdownToC     = this.markdownToC = [];            \r\n            var rendererOptions = this.markedRendererOptions = {  \r\n                toc                  : settings.toc,\r\n                tocm                 : settings.tocm,\r\n                tocStartLevel        : settings.tocStartLevel,\r\n                pageBreak            : settings.pageBreak,\r\n                taskList             : settings.taskList,\r\n                emoji                : settings.emoji,\r\n                tex                  : settings.tex,\r\n                atLink               : settings.atLink,           // for @link\r\n                emailLink            : settings.emailLink,        // for mail address auto link\r\n                flowChart            : settings.flowChart,\r\n                sequenceDiagram      : settings.sequenceDiagram,\r\n                previewCodeHighlight : settings.previewCodeHighlight,\r\n            };\r\n            \r\n            var markedOptions = this.markedOptions = {\r\n                renderer    : editormd.markedRenderer(markdownToC, rendererOptions),\r\n                gfm         : true,\r\n                tables      : true,\r\n                breaks      : true,\r\n                pedantic    : false,\r\n                sanitize    : (settings.htmlDecode) ? false : true,  // HTMLHTMLfalse\r\n                smartLists  : true,\r\n                smartypants : true\r\n            };\r\n            \r\n            marked.setOptions(markedOptions);\r\n                    \r\n            var newMarkdownDoc = editormd.$marked(cmValue, markedOptions);\r\n            \r\n            //console.info(\"cmValue\", cmValue, newMarkdownDoc);\r\n            \r\n            newMarkdownDoc = editormd.filterHTMLTags(newMarkdownDoc, settings.htmlDecode);\r\n            \r\n            //console.error(\"cmValue\", cmValue, newMarkdownDoc);\r\n            \r\n            this.markdownTextarea.text(cmValue);\r\n            \r\n            cm.save();\r\n            \r\n            if (settings.saveHTMLToTextarea) \r\n            {\r\n                this.htmlTextarea.text(newMarkdownDoc);\r\n            }\r\n            \r\n            if(settings.watch || (!settings.watch && state.preview))\r\n            {\r\n                previewContainer.html(newMarkdownDoc);\r\n\r\n                this.previewCodeHighlight();\r\n                \r\n                if (settings.toc) \r\n                {\r\n                    var tocContainer = (settings.tocContainer === \"\") ? previewContainer : $(settings.tocContainer);\r\n                    var tocMenu      = tocContainer.find(\".\" + this.classPrefix + \"toc-menu\");\r\n                    \r\n                    tocContainer.attr(\"previewContainer\", (settings.tocContainer === \"\") ? \"true\" : \"false\");\r\n                    \r\n                    if (settings.tocContainer !== \"\" && tocMenu.length > 0)\r\n                    {\r\n                        tocMenu.remove();\r\n                    }\r\n                    \r\n                    editormd.markdownToCRenderer(markdownToC, tocContainer, settings.tocDropdown, settings.tocStartLevel);\r\n            \r\n                    if (settings.tocDropdown || tocContainer.find(\".\" + this.classPrefix + \"toc-menu\").length > 0)\r\n                    {\r\n                        editormd.tocDropdownMenu(tocContainer, (settings.tocTitle !== \"\") ? settings.tocTitle : this.lang.tocTitle);\r\n                    }\r\n            \r\n                    if (settings.tocContainer !== \"\")\r\n                    {\r\n                        previewContainer.find(\".markdown-toc\").css(\"border\", \"none\");\r\n                    }\r\n                }\r\n                \r\n                if (settings.tex)\r\n                {\r\n                    if (!editormd.kaTeXLoaded && settings.autoLoadModules) \r\n                    {\r\n                        editormd.loadKaTeX(function() {\r\n                            editormd.$katex = katex;\r\n                            editormd.kaTeXLoaded = true;\r\n                            _this.katexRender();\r\n                        });\r\n                    } \r\n                    else \r\n                    {\r\n                        editormd.$katex = katex;\r\n                        this.katexRender();\r\n                    }\r\n                }                \r\n                \r\n                if (settings.flowChart || settings.sequenceDiagram)\r\n                {\r\n                    flowchartTimer = setTimeout(function(){\r\n                        clearTimeout(flowchartTimer);\r\n                        _this.flowChartAndSequenceDiagramRender();\r\n                        flowchartTimer = null;\r\n                    }, 10);\r\n                }\r\n\r\n                if (state.loaded) \r\n                {\r\n                    $.proxy(settings.onchange, this)();\r\n                }\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Focusing the cursor position\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        focus : function() {\r\n            this.cm.focus();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set cursor position\r\n         * \r\n         * @param   {Object}    cursor {line:1, ch:0}\r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        setCursor : function(cursor) {\r\n            this.cm.setCursor(cursor);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Get the current position of the cursor\r\n         * \r\n         * @returns {Cursor}         Cursor\r\n         */\r\n        \r\n        getCursor : function() {\r\n            return this.cm.getCursor();\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set cursor selected ranges\r\n         * \r\n         * @param   {Object}    from   {line:1, ch:0}\r\n         * @param   {Object}    to     {line:1, ch:0}\r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        setSelection : function(from, to) {\r\n        \r\n            this.cm.setSelection(from, to);\r\n        \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Get the texts from cursor selected\r\n         * \r\n         * @returns {String}         \r\n         */\r\n        \r\n        getSelection : function() {\r\n            return this.cm.getSelection();\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set the cursor selection ranges\r\n         * \r\n         * @param   {Array}    ranges  cursor selection ranges array\r\n         * @returns {Array}            return this\r\n         */\r\n        \r\n        setSelections : function(ranges) {\r\n            this.cm.setSelections(ranges);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Get the cursor selection ranges\r\n         * \r\n         * @returns {Array}         return selection ranges array\r\n         */\r\n        \r\n        getSelections : function() {\r\n            return this.cm.getSelections();\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Replace the text at the current cursor selected or insert a new character at the current cursor position\r\n         * \r\n         * @param   {String}    value  \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        replaceSelection : function(value) {\r\n            this.cm.replaceSelection(value);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Insert a new character at the current cursor position\r\n         *\r\n         * replaceSelection()\r\n         * With the replaceSelection() method\r\n         * \r\n         * @param   {String}    value  \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        insertValue : function(value) {\r\n            this.replaceSelection(value);\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * markdown\r\n         * append Markdown to editor\r\n         * \r\n         * @param   {String}    md     markdown\r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        appendMarkdown : function(md) {\r\n            var settings = this.settings;\r\n            var cm       = this.cm;\r\n            \r\n            cm.setValue(cm.getValue() + md);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * markdown\r\n         * Set Markdown source document\r\n         * \r\n         * @param   {String}    md     markdown\r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        setMarkdown : function(md) {\r\n            this.cm.setValue(md || this.settings.markdown);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * markdown\r\n         * Set Editor.md markdown/CodeMirror value\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        getMarkdown : function() {\r\n            return this.cm.getValue();\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Get CodeMirror value\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        getValue : function() {\r\n            return this.cm.getValue();\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Set CodeMirror value\r\n         * \r\n         * @param   {String}     value   set code/value/string/text\r\n         * @returns {editormd}           editormd\r\n         */\r\n        \r\n        setValue : function(value) {\r\n            this.cm.setValue(value);\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Empty CodeMirror editor container\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        clear : function() {\r\n            this.cm.setValue(\"\");\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * TextareaHTML\r\n         * Get parsed html code from Textarea\r\n         * \r\n         * @returns {String}               HTML\r\n         */\r\n        \r\n        getHTML : function() {\r\n            if (!this.settings.saveHTMLToTextarea)\r\n            {\r\n                alert(\"Error: settings.saveHTMLToTextarea == false\");\r\n\r\n                return false;\r\n            }\r\n            \r\n            return this.htmlTextarea.val();\r\n        },\r\n        \r\n        /**\r\n         * getHTML()\r\n         * getHTML (alias)\r\n         * \r\n         * @returns {String}           Return html code HTML\r\n         */\r\n        \r\n        getTextareaSavedHTML : function() {\r\n            return this.getHTML();\r\n        },\r\n        \r\n        /**\r\n         * HTML\r\n         * Get html from preview container\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        getPreviewedHTML : function() {\r\n            if (!this.settings.watch)\r\n            {\r\n                alert(\"Error: settings.watch == false\");\r\n\r\n                return false;\r\n            }\r\n            \r\n            return this.previewContainer.html();\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Enable real-time watching\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        watch : function(callback) {     \r\n            var settings        = this.settings;\r\n            \r\n            if ($.inArray(settings.mode, [\"gfm\", \"markdown\"]) < 0)\r\n            {\r\n                return this;\r\n            }\r\n            \r\n            this.state.watching = settings.watch = true;\r\n            this.preview.show();\r\n            \r\n            if (this.toolbar)\r\n            {\r\n                var watchIcon   = settings.toolbarIconsClass.watch;\r\n                var unWatchIcon = settings.toolbarIconsClass.unwatch;\r\n                \r\n                var icon        = this.toolbar.find(\".fa[name=watch]\");\r\n                icon.parent().attr(\"title\", settings.lang.toolbar.watch);\r\n                icon.removeClass(unWatchIcon).addClass(watchIcon);\r\n            }\r\n            \r\n            this.codeMirror.css(\"border-right\", \"1px solid #ddd\").width(this.editor.width() / 2); \r\n            \r\n            timer = 0;\r\n            \r\n            this.save().resize();\r\n            \r\n            if (!settings.onwatch)\r\n            {\r\n                settings.onwatch = callback || function() {};\r\n            }\r\n            \r\n            $.proxy(settings.onwatch, this)();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Disable real-time watching\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        unwatch : function(callback) {\r\n            var settings        = this.settings;\r\n            this.state.watching = settings.watch = false;\r\n            this.preview.hide();\r\n            \r\n            if (this.toolbar) \r\n            {\r\n                var watchIcon   = settings.toolbarIconsClass.watch;\r\n                var unWatchIcon = settings.toolbarIconsClass.unwatch;\r\n                \r\n                var icon    = this.toolbar.find(\".fa[name=watch]\");\r\n                icon.parent().attr(\"title\", settings.lang.toolbar.unwatch);\r\n                icon.removeClass(watchIcon).addClass(unWatchIcon);\r\n            }\r\n            \r\n            this.codeMirror.css(\"border-right\", \"none\").width(this.editor.width());\r\n            \r\n            this.resize();\r\n            \r\n            if (!settings.onunwatch)\r\n            {\r\n                settings.onunwatch = callback || function() {};\r\n            }\r\n            \r\n            $.proxy(settings.onunwatch, this)();\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Show editor\r\n         * \r\n         * @param   {Function} [callback=function()] \r\n         * @returns {editormd}                       editormd\r\n         */\r\n        \r\n        show : function(callback) {\r\n            callback  = callback || function() {};\r\n            \r\n            var _this = this;\r\n            this.editor.show(0, function() {\r\n                $.proxy(callback, _this)();\r\n            });\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Hide editor\r\n         * \r\n         * @param   {Function} [callback=function()] \r\n         * @returns {editormd}                       editormd\r\n         */\r\n        \r\n        hide : function(callback) {\r\n            callback  = callback || function() {};\r\n            \r\n            var _this = this;\r\n            this.editor.hide(0, function() {\r\n                $.proxy(callback, _this)();\r\n            });\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * HTML\r\n         * Enter preview html state\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        previewing : function() {\r\n            \r\n            var _this            = this;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var codeMirror       = this.codeMirror;\r\n            var previewContainer = this.previewContainer;\r\n            \r\n            if ($.inArray(settings.mode, [\"gfm\", \"markdown\"]) < 0) {\r\n                return this;\r\n            }\r\n            \r\n            if (settings.toolbar && toolbar) {\r\n                toolbar.toggle();\r\n                toolbar.find(\".fa[name=preview]\").toggleClass(\"active\");\r\n            }\r\n            \r\n            codeMirror.toggle();\r\n            \r\n            var escHandle = function(event) {\r\n                if (event.shiftKey && event.keyCode === 27) {\r\n                    _this.previewed();\r\n                }\r\n            };\r\n\r\n            if (codeMirror.css(\"display\") === \"none\") // ZeptocodeMirror.is(\":hidden\")\r\n            {\r\n                this.state.preview = true;\r\n\r\n                if (this.state.fullscreen) {\r\n                    preview.css(\"background\", \"#fff\");\r\n                }\r\n                \r\n                editor.find(\".\" + this.classPrefix + \"preview-close-btn\").show().bind(editormd.mouseOrTouch(\"click\", \"touchend\"), function(){\r\n                    _this.previewed();\r\n                });\r\n            \r\n                if (!settings.watch)\r\n                {\r\n                    this.save();\r\n                } \r\n                else \r\n                {\r\n                    previewContainer.css(\"padding\", \"\");\r\n                }\r\n                \r\n                previewContainer.addClass(this.classPrefix + \"preview-active\");\r\n\r\n                preview.show().css({\r\n                    position  : \"\",\r\n                    top       : 0,\r\n                    width     : editor.width(),\r\n                    height    : (settings.autoHeight && !this.state.fullscreen) ? \"auto\" : editor.height()\r\n                });\r\n                \r\n                if (this.state.loaded)\r\n                {\r\n                    $.proxy(settings.onpreviewing, this)();\r\n                }\r\n\r\n                $(window).bind(\"keyup\", escHandle);\r\n            } \r\n            else \r\n            {\r\n                $(window).unbind(\"keyup\", escHandle);\r\n                this.previewed();\r\n            }\r\n        },\r\n        \r\n        /**\r\n         * HTML\r\n         * Exit preview html state\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        previewed : function() {\r\n            \r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var previewContainer = this.previewContainer;\r\n            var previewCloseBtn  = editor.find(\".\" + this.classPrefix + \"preview-close-btn\");\r\n\r\n            this.state.preview   = false;\r\n            \r\n            this.codeMirror.show();\r\n            \r\n            if (settings.toolbar) {\r\n                toolbar.show();\r\n            }\r\n            \r\n            preview[(settings.watch) ? \"show\" : \"hide\"]();\r\n            \r\n            previewCloseBtn.hide().unbind(editormd.mouseOrTouch(\"click\", \"touchend\"));\r\n                \r\n            previewContainer.removeClass(this.classPrefix + \"preview-active\");\r\n                \r\n            if (settings.watch)\r\n            {\r\n                previewContainer.css(\"padding\", \"20px\");\r\n            }\r\n            \r\n            preview.css({ \r\n                background : null,\r\n                position   : \"absolute\",\r\n                width      : editor.width() / 2,\r\n                height     : (settings.autoHeight && !this.state.fullscreen) ? \"auto\" : editor.height() - toolbar.height(),\r\n                top        : (settings.toolbar)    ? toolbar.height() : 0\r\n            });\r\n\r\n            if (this.state.loaded)\r\n            {\r\n                $.proxy(settings.onpreviewed, this)();\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Fullscreen show\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        fullscreen : function() {\r\n            \r\n            var _this            = this;\r\n            var state            = this.state;\r\n            var editor           = this.editor;\r\n            var preview          = this.preview;\r\n            var toolbar          = this.toolbar;\r\n            var settings         = this.settings;\r\n            var fullscreenClass  = this.classPrefix + \"fullscreen\";\r\n            \r\n            if (toolbar) {\r\n                toolbar.find(\".fa[name=fullscreen]\").parent().toggleClass(\"active\"); \r\n            }\r\n            \r\n            var escHandle = function(event) {\r\n                if (!event.shiftKey && event.keyCode === 27) \r\n                {\r\n                    if (state.fullscreen)\r\n                    {\r\n                        _this.fullscreenExit();\r\n                    }\r\n                }\r\n            };\r\n\r\n            if (!editor.hasClass(fullscreenClass)) \r\n            {\r\n                state.fullscreen = true;\r\n\r\n                $(\"html,body\").css(\"overflow\", \"hidden\");\r\n                \r\n                editor.css({\r\n                    width    : $(window).width(),\r\n                    height   : $(window).height()\r\n                }).addClass(fullscreenClass);\r\n\r\n                this.resize();\r\n    \r\n                $.proxy(settings.onfullscreen, this)();\r\n\r\n                $(window).bind(\"keyup\", escHandle);\r\n            }\r\n            else\r\n            {           \r\n                $(window).unbind(\"keyup\", escHandle); \r\n                this.fullscreenExit();\r\n            }\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Exit fullscreen state\r\n         * \r\n         * @returns {editormd}         editormd\r\n         */\r\n        \r\n        fullscreenExit : function() {\r\n            \r\n            var editor            = this.editor;\r\n            var settings          = this.settings;\r\n            var toolbar           = this.toolbar;\r\n            var fullscreenClass   = this.classPrefix + \"fullscreen\";  \r\n            \r\n            this.state.fullscreen = false;\r\n            \r\n            if (toolbar) {\r\n                toolbar.find(\".fa[name=fullscreen]\").parent().removeClass(\"active\"); \r\n            }\r\n\r\n            $(\"html,body\").css(\"overflow\", \"\");\r\n\r\n            editor.css({\r\n                width    : editor.data(\"oldWidth\"),\r\n                height   : editor.data(\"oldHeight\")\r\n            }).removeClass(fullscreenClass);\r\n\r\n            this.resize();\r\n            \r\n            $.proxy(settings.onfullscreenExit, this)();\r\n\r\n            return this;\r\n        },\r\n        \r\n        /**\r\n         * \r\n         * Load and execute the plugin\r\n         * \r\n         * @param   {String}     name    plugin name / function name\r\n         * @param   {String}     path    plugin load path\r\n         * @returns {editormd}           editormd\r\n         */\r\n        \r\n        executePlugin : function(name, path) {\r\n            \r\n            var _this    = this;\r\n            var cm       = this.cm;\r\n            var settings = this.settings;\r\n            \r\n            path = settings.pluginPath + path;\r\n            \r\n            if (typeof define === \"function\") \r\n            {            \r\n                if (typeof this[name] === \"undefined\")\r\n                {\r\n                    alert(\"Error: \" + name + \" plugin is not found, you are not load this plugin.\");\r\n                    \r\n                    return this;\r\n                }\r\n                \r\n                this[name](cm);\r\n                \r\n                return this;\r\n            }\r\n            \r\n            if ($.inArray(path, editormd.loadFiles.plugin) < 0)\r\n            {\r\n                editormd.loadPlugin(path, function() {\r\n                    editormd.loadPlugins[name] = _this[name];\r\n                    _this[name](cm);\r\n                });\r\n            }\r\n            else\r\n            {\r\n                $.proxy(editormd.loadPlugins[name], this)(cm);\r\n            }\r\n            \r\n            return this;\r\n        },\r\n                \r\n        /**\r\n         * \r\n         * Search & replace\r\n         * \r\n         * @param   {String}     command    CodeMirror serach commands, \"find, fintNext, fintPrev, clearSearch, replace, replaceAll\"\r\n         * @returns {editormd}              return this\r\n         */\r\n        \r\n        search : function(command) {\r\n            var settings = this.settings;\r\n            \r\n            if (!settings.searchReplace)\r\n            {\r\n                alert(\"Error: settings.searchReplace == false\");\r\n                return this;\r\n            }\r\n            \r\n            if (!settings.readOnly)\r\n            {\r\n                this.cm.execCommand(command || \"find\");\r\n            }\r\n            \r\n            return this;\r\n        },\r\n        \r\n        searchReplace : function() {            \r\n            this.search(\"replace\");\r\n            \r\n            return this;\r\n        },\r\n        \r\n        searchReplaceAll : function() {          \r\n            this.search(\"replaceAll\");\r\n            \r\n            return this;\r\n        }\r\n    };\r\n    \r\n    editormd.fn.init.prototype = editormd.fn; \r\n   \r\n    /**\r\n     * \r\n     * lock screen when dialog opening\r\n     * \r\n     * @returns {void}\r\n     */\r\n\r\n    editormd.dialogLockScreen = function() {\r\n        var settings = this.settings || {dialogLockScreen : true};\r\n        \r\n        if (settings.dialogLockScreen) \r\n        {            \r\n            $(\"html,body\").css(\"overflow\", \"hidden\");\r\n            this.resize();\r\n        }\r\n    };\r\n   \r\n    /**\r\n     * \r\n     * Display mask layer when dialog opening\r\n     * \r\n     * @param   {Object}     dialog    dialog jQuery object\r\n     * @returns {void}\r\n     */\r\n    \r\n    editormd.dialogShowMask = function(dialog) {\r\n        var editor   = this.editor;\r\n        var settings = this.settings || {dialogShowMask : true};\r\n        \r\n        dialog.css({\r\n            top  : ($(window).height() - dialog.height()) / 2 + \"px\",\r\n            left : ($(window).width()  - dialog.width())  / 2 + \"px\"\r\n        });\r\n\r\n        if (settings.dialogShowMask) {\r\n            editor.children(\".\" + this.classPrefix + \"mask\").css(\"z-index\", parseInt(dialog.css(\"z-index\")) - 1).show();\r\n        }\r\n    };\r\n\r\n    editormd.toolbarHandlers = {\r\n        undo : function() {\r\n            this.cm.undo();\r\n        },\r\n        \r\n        redo : function() {\r\n            this.cm.redo();\r\n        },\r\n        \r\n        bold : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"**\" + selection + \"**\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n        \r\n        del : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"~~\" + selection + \"~~\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n\r\n        italic : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"*\" + selection + \"*\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n\r\n        quote : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"> \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"> \" + selection);\r\n            }\r\n\r\n            //cm.replaceSelection(\"> \" + selection);\r\n            //cm.setCursor(cursor.line, (selection === \"\") ? cursor.ch + 2 : cursor.ch + selection.length + 2);\r\n        },\r\n        \r\n        ucfirst : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(editormd.firstUpperCase(selection));\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        ucwords : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(editormd.wordsFirstUpperCase(selection));\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        uppercase : function() {\r\n            var cm         = this.cm;\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n\r\n            cm.replaceSelection(selection.toUpperCase());\r\n            cm.setSelections(selections);\r\n        },\r\n        \r\n        lowercase : function() {\r\n            var cm         = this.cm;\r\n            var cursor     = cm.getCursor();\r\n            var selection  = cm.getSelection();\r\n            var selections = cm.listSelections();\r\n            \r\n            cm.replaceSelection(selection.toLowerCase());\r\n            cm.setSelections(selections);\r\n        },\r\n\r\n        h1 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"# \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"# \" + selection);\r\n            }\r\n        },\r\n\r\n        h2 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"## \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 3);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"## \" + selection);\r\n            }\r\n        },\r\n\r\n        h3 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 4);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"### \" + selection);\r\n            }\r\n        },\r\n\r\n        h4 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"#### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 5);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"#### \" + selection);\r\n            }\r\n        },\r\n\r\n        h5 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"##### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 6);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"##### \" + selection);\r\n            }\r\n        },\r\n\r\n        h6 : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (cursor.ch !== 0)\r\n            {\r\n                cm.setCursor(cursor.line, 0);\r\n                cm.replaceSelection(\"###### \" + selection);\r\n                cm.setCursor(cursor.line, cursor.ch + 7);\r\n            }\r\n            else\r\n            {\r\n                cm.replaceSelection(\"###### \" + selection);\r\n            }\r\n        },\r\n\r\n        \"list-ul\" : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if (selection === \"\") \r\n            {\r\n                cm.replaceSelection(\"- \" + selection);\r\n            } \r\n            else \r\n            {\r\n                var selectionText = selection.split(\"\\n\");\r\n\r\n                for (var i = 0, len = selectionText.length; i < len; i++) \r\n                {\r\n                    selectionText[i] = (selectionText[i] === \"\") ? \"\" : \"- \" + selectionText[i];\r\n                }\r\n\r\n                cm.replaceSelection(selectionText.join(\"\\n\"));\r\n            }\r\n        },\r\n\r\n        \"list-ol\" : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            if(selection === \"\") \r\n            {\r\n                cm.replaceSelection(\"1. \" + selection);\r\n            }\r\n            else\r\n            {\r\n                var selectionText = selection.split(\"\\n\");\r\n\r\n                for (var i = 0, len = selectionText.length; i < len; i++) \r\n                {\r\n                    selectionText[i] = (selectionText[i] === \"\") ? \"\" : (i+1) + \". \" + selectionText[i];\r\n                }\r\n\r\n                cm.replaceSelection(selectionText.join(\"\\n\"));\r\n            }\r\n        },\r\n\r\n        hr : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(((cursor.ch !== 0) ? \"\\n\\n\" : \"\\n\") + \"------------\\n\\n\");\r\n        },\r\n\r\n        tex : function() {\r\n            if (!this.settings.tex)\r\n            {\r\n                alert(\"settings.tex === false\");\r\n                return this;\r\n            }\r\n            \r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"$$\" + selection + \"$$\");\r\n\r\n            if(selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 2);\r\n            }\r\n        },\r\n\r\n        link : function() {\r\n            this.executePlugin(\"linkDialog\", \"link-dialog/link-dialog\");\r\n        },\r\n\r\n        \"reference-link\" : function() {\r\n            this.executePlugin(\"referenceLinkDialog\", \"reference-link-dialog/reference-link-dialog\");\r\n        },\r\n\r\n        pagebreak : function() {\r\n            if (!this.settings.pageBreak)\r\n            {\r\n                alert(\"settings.pageBreak === false\");\r\n                return this;\r\n            }\r\n            \r\n            var cm        = this.cm;\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"\\r\\n[========]\\r\\n\");\r\n        },\r\n\r\n        image : function() {\r\n            this.executePlugin(\"imageDialog\", \"image-dialog/image-dialog\");\r\n        },\r\n        \r\n        code : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n\r\n            cm.replaceSelection(\"`\" + selection + \"`\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n\r\n        \"code-block\" : function() {\r\n            this.executePlugin(\"codeBlockDialog\", \"code-block-dialog/code-block-dialog\");            \r\n        },\r\n\r\n        \"preformatted-text\" : function() {\r\n            this.executePlugin(\"preformattedTextDialog\", \"preformatted-text-dialog/preformatted-text-dialog\");\r\n        },\r\n        \r\n        table : function() {\r\n            this.executePlugin(\"tableDialog\", \"table-dialog/table-dialog\");         \r\n        },\r\n        \r\n        datetime : function() {\r\n            var cm        = this.cm;\r\n            var selection = cm.getSelection();\r\n            var date      = new Date();\r\n            var langName  = this.settings.lang.name;\r\n            var datefmt   = editormd.dateFormat() + \" \" + editormd.dateFormat((langName === \"zh-cn\" || langName === \"zh-tw\") ? \"cn-week-day\" : \"week-day\");\r\n\r\n            cm.replaceSelection(datefmt);\r\n        },\r\n        \r\n        emoji : function() {\r\n            this.executePlugin(\"emojiDialog\", \"emoji-dialog/emoji-dialog\");\r\n        },\r\n                \r\n        \"html-entities\" : function() {\r\n            this.executePlugin(\"htmlEntitiesDialog\", \"html-entities-dialog/html-entities-dialog\");\r\n        },\r\n                \r\n        \"goto-line\" : function() {\r\n            this.executePlugin(\"gotoLineDialog\", \"goto-line-dialog/goto-line-dialog\");\r\n        },\r\n\r\n        watch : function() {    \r\n            this[this.settings.watch ? \"unwatch\" : \"watch\"]();\r\n        },\r\n\r\n        preview : function() {\r\n            this.previewing();\r\n        },\r\n\r\n        fullscreen : function() {\r\n            this.fullscreen();\r\n        },\r\n\r\n        clear : function() {\r\n            this.clear();\r\n        },\r\n        \r\n        search : function() {\r\n            this.search();\r\n        },\r\n\r\n        help : function() {\r\n            this.executePlugin(\"helpDialog\", \"help-dialog/help-dialog\");\r\n        },\r\n\r\n        info : function() {\r\n            this.showInfoDialog();\r\n        }\r\n    };\r\n    \r\n    var isMac = navigator.platform.toUpperCase().indexOf('MAC')>=0;\r\n    var key = isMac ? \"Cmd\" : \"Ctrl\";\r\n    \r\n    editormd.keyMaps = {\r\n        [key + \"-1\"]       : \"h1\",\r\n        [key + \"-2\"]       : \"h2\",\r\n        [key + \"-3\"]       : \"h3\",\r\n        [key + \"-4\"]       : \"h4\",\r\n        [key + \"-5\"]       : \"h5\",\r\n        [key + \"-6\"]       : \"h6\",\r\n        [key + \"-B\"]       : \"bold\",  // if this is string ==  editormd.toolbarHandlers.xxxx\r\n        [key + \"-D\"]       : \"datetime\",\r\n        \r\n        [key + \"Ctrl-E\"]       : function() { // emoji\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            if (!this.settings.emoji)\r\n            {\r\n                alert(\"Error: settings.emoji == false\");\r\n                return ;\r\n            }\r\n\r\n            cm.replaceSelection(\":\" + selection + \":\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        [key + \"-Alt-G\"]   : \"goto-line\",\r\n        [key + \"-H\"]       : \"hr\",\r\n        [key + \"-I\"]       : \"italic\",\r\n        [key + \"-K\"]       : \"code\",\r\n        \r\n        \"Ctrl-L\"        : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            var title = (selection === \"\") ? \"\" : \" \\\"\"+selection+\"\\\"\";\r\n\r\n            cm.replaceSelection(\"[\" + selection + \"](\"+title+\")\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        [key + \"-U\"]         : \"list-ul\",\r\n        \r\n        \"Shift-Ctrl-A\"   : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            if (!this.settings.atLink)\r\n            {\r\n                alert(\"Error: settings.atLink == false\");\r\n                return ;\r\n            }\r\n\r\n            cm.replaceSelection(\"@\" + selection);\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 1);\r\n            }\r\n        },\r\n        \r\n        [\"Shift\" + key + \"-C\"]     : \"code\",\r\n        [\"Shift\" + key + \"Q\"]     : \"quote\",\r\n        [\"Shift\" + key + \"S\"]     : \"del\",\r\n        [\"Shift\" + key + \"K\"]     : \"tex\",  // KaTeX\r\n        \r\n        \"Shift-Alt-C\"      : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            cm.replaceSelection([\"```\", selection, \"```\"].join(\"\\n\"));\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 3);\r\n            } \r\n        },\r\n        \r\n        [\"Shift-\" + key + \"-Alt-C\"]      : \"code-block\",\r\n        [\"Shift-\" + key + \"-H\"]          : \"html-entities\",\r\n        \"Shift-Alt-H\"                    : \"help\",\r\n        [\"Shift-\" + key + \"-E\"]          : \"emoji\",\r\n        [\"Shift-\" + key + \"-U\"]          : \"uppercase\",\r\n        \"Shift-Alt-U\"                    : \"ucwords\",\r\n        [\"Shift-\" + key + \"-Alt-U\"]      : \"ucfirst\",\r\n        \"Shift-Alt-L\"                    : \"lowercase\",\r\n        \r\n        [\"Shift-\" + key + \"-I\"]          : function() {\r\n            var cm        = this.cm;\r\n            var cursor    = cm.getCursor();\r\n            var selection = cm.getSelection();\r\n            \r\n            var title = (selection === \"\") ? \"\" : \" \\\"\"+selection+\"\\\"\";\r\n\r\n            cm.replaceSelection(\"![\" + selection + \"](\"+title+\")\");\r\n\r\n            if (selection === \"\") {\r\n                cm.setCursor(cursor.line, cursor.ch + 4);\r\n            }\r\n        },\r\n        \r\n        [\"Shift-\" + key + \"-Alt-I\"]     : \"image\",\r\n        [\"Shift-\" + key + \"-L\"]         : \"link\",\r\n        [\"Shift-\" + key + \"-O\"]         : \"list-ol\",\r\n        [\"Shift-\" + key + \"-P\"]         : \"preformatted-text\",\r\n        [\"Shift-\" + key + \"-T\"]         : \"table\",\r\n        \"Shift-Alt-P\"                   : \"pagebreak\",\r\n        \"F9\"                            : \"watch\",\r\n        \"F10\"                           : \"preview\",\r\n        \"F11\"                           : \"fullscreen\",\r\n    };\r\n    \r\n    /**\r\n     * \r\n     * Clear the space of strings both sides.\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   trimed string    \r\n     */\r\n    \r\n    var trim = function(str) {\r\n        return (!String.prototype.trim) ? str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, \"\") : str.trim();\r\n    };\r\n    \r\n    editormd.trim = trim;\r\n    \r\n    /**\r\n     * \r\n     * Words first to uppercase\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   string\r\n     */\r\n    \r\n    var ucwords = function (str) {\r\n        return str.toLowerCase().replace(/\\b(\\w)|\\s(\\w)/g, function($1) {  \r\n            return $1.toUpperCase();\r\n        });\r\n    };\r\n    \r\n    editormd.ucwords = editormd.wordsFirstUpperCase = ucwords;\r\n    \r\n    /**\r\n     * \r\n     * Only string first char to uppercase\r\n     * \r\n     * @param   {String}    str            string\r\n     * @returns {String}                   string\r\n     */\r\n    \r\n    var firstUpperCase = function(str) {        \r\n        return str.toLowerCase().replace(/\\b(\\w)/, function($1){\r\n            return $1.toUpperCase();\r\n        });\r\n    };\r\n    \r\n    var ucfirst = firstUpperCase;\r\n    \r\n    editormd.firstUpperCase = editormd.ucfirst = firstUpperCase;\r\n    \r\n    editormd.urls = {\r\n        atLinkBase : \"https://github.com/\"\r\n    };\r\n    \r\n    editormd.regexs = {\r\n        atLink        : /@(\\w+)/g,\r\n        email         : /(\\w+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,\r\n        emailLink     : /(mailto:)?([\\w\\.\\_]+)@(\\w+)\\.(\\w+)\\.?(\\w+)?/g,\r\n        emoji         : /:([\\w\\+-]+):/g,\r\n        emojiDatetime : /(\\d{1,2}:\\d{1,2}:\\d{1,2})/g,\r\n        twemoji       : /:(tw-([\\w]+)-?(\\w+)?):/g,\r\n        fontAwesome   : /:(fa-([\\w]+)(-(\\w+)){0,}):/g,\r\n        editormdLogo  : /:(editormd-logo-?(\\w+)?):/g,\r\n        pageBreak     : /^\\[[=]{8,}\\]$/\r\n    };\r\n\r\n    // Emoji graphics files url path\r\n    editormd.emoji     = {\r\n        path  : \"http://www.emoji-cheat-sheet.com/graphics/emojis/\",\r\n        ext   : \".png\"\r\n    };\r\n\r\n    // Twitter Emoji (Twemoji)  graphics files url path    \r\n    editormd.twemoji = {\r\n        path : \"http://twemoji.maxcdn.com/36x36/\",\r\n        ext  : \".png\"\r\n    };\r\n\r\n    /**\r\n     * marked\r\n     * Custom Marked renderer rules\r\n     * \r\n     * @param   {Array}    markdownToC     TOC\r\n     * @returns {Renderer} markedRenderer  markedRenderer\r\n     */\r\n\r\n    editormd.markedRenderer = function(markdownToC, options) {\r\n        var defaults = {\r\n            toc                  : true,           // Table of contents\r\n            tocm                 : false,\r\n            tocStartLevel        : 1,              // Said from H1 to create ToC  \r\n            pageBreak            : true,\r\n            atLink               : true,           // for @link\r\n            emailLink            : true,           // for mail address auto link\r\n            taskList             : false,          // Enable Github Flavored Markdown task lists\r\n            emoji                : false,          // :emoji: , Support Twemoji, fontAwesome, Editor.md logo emojis.\r\n            tex                  : false,          // TeX(LaTeX), based on KaTeX\r\n            flowChart            : false,          // flowChart.js only support IE9+\r\n            sequenceDiagram      : false,          // sequenceDiagram.js only support IE9+\r\n        };\r\n        \r\n        var settings        = $.extend(defaults, options || {});    \r\n        var marked          = editormd.$marked;\r\n        var markedRenderer  = new marked.Renderer();\r\n        markdownToC         = markdownToC || [];        \r\n            \r\n        var regexs          = editormd.regexs;\r\n        var atLinkReg       = regexs.atLink;\r\n        var emojiReg        = regexs.emoji;\r\n        var emailReg        = regexs.email;\r\n        var emailLinkReg    = regexs.emailLink;\r\n        var twemojiReg      = regexs.twemoji;\r\n        var faIconReg       = regexs.fontAwesome;\r\n        var editormdLogoReg = regexs.editormdLogo;\r\n        var pageBreakReg    = regexs.pageBreak;\r\n\r\n        markedRenderer.emoji = function(text) {\r\n            \r\n            text = text.replace(editormd.regexs.emojiDatetime, function($1) {           \r\n                return $1.replace(/:/g, \"&#58;\");\r\n            });\r\n            \r\n            var matchs = text.match(emojiReg);\r\n\r\n            if (!matchs || !settings.emoji) {\r\n                return text;\r\n            }\r\n\r\n            for (var i = 0, len = matchs.length; i < len; i++)\r\n            {            \r\n                if (matchs[i] === \":+1:\") {\r\n                    matchs[i] = \":\\\\+1:\";\r\n                }\r\n\r\n                text = text.replace(new RegExp(matchs[i]), function($1, $2){\r\n                    var faMatchs = $1.match(faIconReg);\r\n                    var name     = $1.replace(/:/g, \"\");\r\n\r\n                    if (faMatchs)\r\n                    {                        \r\n                        for (var fa = 0, len1 = faMatchs.length; fa < len1; fa++)\r\n                        {\r\n                            var faName = faMatchs[fa].replace(/:/g, \"\");\r\n                            \r\n                            return \"<i class=\\\"fa \" + faName + \" fa-emoji\\\" title=\\\"\" + faName.replace(\"fa-\", \"\") + \"\\\"></i>\";\r\n                        }\r\n                    }\r\n                    else\r\n                    {\r\n                        var emdlogoMathcs = $1.match(editormdLogoReg);\r\n                        var twemojiMatchs = $1.match(twemojiReg);\r\n\r\n                        if (emdlogoMathcs)                                        \r\n                        {                            \r\n                            for (var x = 0, len2 = emdlogoMathcs.length; x < len2; x++)\r\n                            {\r\n                                var logoName = emdlogoMathcs[x].replace(/:/g, \"\");\r\n                                return \"<i class=\\\"\" + logoName + \"\\\" title=\\\"Editor.md logo (\" + logoName + \")\\\"></i>\";\r\n                            }\r\n                        }\r\n                        else if (twemojiMatchs) \r\n                        {\r\n                            for (var t = 0, len3 = twemojiMatchs.length; t < len3; t++)\r\n                            {\r\n                                var twe = twemojiMatchs[t].replace(/:/g, \"\").replace(\"tw-\", \"\");\r\n                                return \"<img src=\\\"\" + editormd.twemoji.path + twe + editormd.twemoji.ext + \"\\\" title=\\\"twemoji-\" + twe + \"\\\" alt=\\\"twemoji-\" + twe + \"\\\" class=\\\"emoji twemoji\\\" />\";\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            var src = (name === \"+1\") ? \"plus1\" : name;\r\n                            src     = (src === \"black_large_square\") ? \"black_square\" : src;\r\n                            src     = (src === \"moon\") ? \"waxing_gibbous_moon\" : src;\r\n\r\n                            return \"<img src=\\\"\" + editormd.emoji.path + src + editormd.emoji.ext + \"\\\" class=\\\"emoji\\\" title=\\\"&#58;\" + name + \"&#58;\\\" alt=\\\"&#58;\" + name + \"&#58;\\\" />\";\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            return text;\r\n        };\r\n\r\n        markedRenderer.atLink = function(text) {\r\n\r\n            if (atLinkReg.test(text))\r\n            { \r\n                if (settings.atLink) \r\n                {\r\n                    text = text.replace(emailReg, function($1, $2, $3, $4) {\r\n                        return $1.replace(/@/g, \"_#_&#64;_#_\");\r\n                    });\r\n\r\n                    text = text.replace(atLinkReg, function($1, $2) {\r\n                        return \"<a href=\\\"\" + editormd.urls.atLinkBase + \"\" + $2 + \"\\\" title=\\\"&#64;\" + $2 + \"\\\" class=\\\"at-link\\\">\" + $1 + \"</a>\";\r\n                    }).replace(/_#_&#64;_#_/g, \"@\");\r\n                }\r\n                \r\n                if (settings.emailLink)\r\n                {\r\n                    text = text.replace(emailLinkReg, function($1, $2, $3, $4, $5) {\r\n                        return (!$2 && $.inArray($5, \"jpg|jpeg|png|gif|webp|ico|icon|pdf\".split(\"|\")) < 0) ? \"<a href=\\\"mailto:\" + $1 + \"\\\">\"+$1+\"</a>\" : $1;\r\n                    });\r\n                }\r\n\r\n                return text;\r\n            }\r\n\r\n            return text;\r\n        };\r\n                \r\n        markedRenderer.link = function (href, title, text) {\r\n\r\n            if (this.options.sanitize) {\r\n                try {\r\n                    var prot = decodeURIComponent(unescape(href)).replace(/[^\\w:]/g,\"\").toLowerCase();\r\n                } catch(e) {\r\n                    return \"\";\r\n                }\r\n\r\n                if (prot.indexOf(\"javascript:\") === 0) {\r\n                    return \"\";\r\n                }\r\n            }\r\n\r\n            var out = \"<a href=\\\"\" + href + \"\\\"\";\r\n            \r\n            if (atLinkReg.test(title) || atLinkReg.test(text))\r\n            {\r\n                if (title)\r\n                {\r\n                    out += \" title=\\\"\" + title.replace(/@/g, \"&#64;\");\r\n                }\r\n                \r\n                return out + \"\\\">\" + text.replace(/@/g, \"&#64;\") + \"</a>\";\r\n            }\r\n\r\n            if (title) {\r\n                out += \" title=\\\"\" + title + \"\\\"\";\r\n            }\r\n\r\n            out += \">\" + text + \"</a>\";\r\n\r\n            return out;\r\n        };\r\n        \r\n        markedRenderer.heading = function(text, level, raw) {\r\n                    \r\n            var linkText       = text;\r\n            var hasLinkReg     = /\\s*\\<a\\s*href\\=\\\"(.*)\\\"\\s*([^\\>]*)\\>(.*)\\<\\/a\\>\\s*/;\r\n            var getLinkTextReg = /\\s*\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>\\s*/g;\r\n\r\n            if (hasLinkReg.test(text)) \r\n            {\r\n                var tempText = [];\r\n                text         = text.split(/\\<a\\s*([^\\>]+)\\>([^\\>]*)\\<\\/a\\>/);\r\n\r\n                for (var i = 0, len = text.length; i < len; i++)\r\n                {\r\n                    tempText.push(text[i].replace(/\\s*href\\=\\\"(.*)\\\"\\s*/g, \"\"));\r\n                }\r\n\r\n                text = tempText.join(\" \");\r\n            }\r\n            \r\n            text = trim(text);\r\n            \r\n            var escapedText    = text.toLowerCase().replace(/[^\\w]+/g, \"-\");\r\n            var toc = {\r\n                text  : text,\r\n                level : level,\r\n                slug  : escapedText\r\n            };\r\n            \r\n            var isChinese = /^[\\u4e00-\\u9fa5]+$/.test(text);\r\n            var id        = (isChinese) ? escape(text).replace(/\\%/g, \"\") : text.toLowerCase().replace(/[^\\w]+/g, \"-\");\r\n\r\n            markdownToC.push(toc);\r\n            \r\n            var headingHTML = \"<h\" + level + \" id=\\\"h\"+ level + \"-\" + this.options.headerPrefix + id +\"\\\">\";\r\n            \r\n            headingHTML    += \"<a name=\\\"\" + text + \"\\\" class=\\\"reference-link\\\"></a>\";\r\n            headingHTML    += \"<span class=\\\"header-link octicon octicon-link\\\"></span>\";\r\n            headingHTML    += (hasLinkReg) ? this.atLink(this.emoji(linkText)) : this.atLink(this.emoji(text));\r\n            headingHTML    += \"</h\" + level + \">\";\r\n\r\n            return headingHTML;\r\n        };\r\n        \r\n        markedRenderer.pageBreak = function(text) {\r\n            if (pageBreakReg.test(text) && settings.pageBreak)\r\n            {\r\n                text = \"<hr style=\\\"page-break-after:always;\\\" class=\\\"page-break editormd-page-break\\\" />\";\r\n            }\r\n            \r\n            return text;\r\n        };\r\n\r\n        markedRenderer.paragraph = function(text) {\r\n            var isTeXInline     = /\\$\\$(.*)\\$\\$/g.test(text);\r\n            var isTeXLine       = /^\\$\\$(.*)\\$\\$$/.test(text);\r\n            var isTeXAddClass   = (isTeXLine)     ? \" class=\\\"\" + editormd.classNames.tex + \"\\\"\" : \"\";\r\n            var isToC           = (settings.tocm) ? /^(\\[TOC\\]|\\[TOCM\\])$/.test(text) : /^\\[TOC\\]$/.test(text);\r\n            var isToCMenu       = /^\\[TOCM\\]$/.test(text);\r\n            \r\n            if (!isTeXLine && isTeXInline) \r\n            {\r\n                text = text.replace(/(\\$\\$([^\\$]*)\\$\\$)+/g, function($1, $2) {\r\n                    return \"<span class=\\\"\" + editormd.classNames.tex + \"\\\">\" + $2.replace(/\\$/g, \"\") + \"</span>\";\r\n                });\r\n            } \r\n            else \r\n            {\r\n                text = (isTeXLine) ? text.replace(/\\$/g, \"\") : text;\r\n            }\r\n            \r\n            var tocHTML = \"<div class=\\\"markdown-toc editormd-markdown-toc\\\">\" + text + \"</div>\";\r\n            \r\n            return (isToC) ? ( (isToCMenu) ? \"<div class=\\\"editormd-toc-menu\\\">\" + tocHTML + \"</div><br/>\" : tocHTML )\r\n                           : ( (pageBreakReg.test(text)) ? this.pageBreak(text) : \"<p\" + isTeXAddClass + \">\" + this.atLink(this.emoji(text)) + \"</p>\\n\" );\r\n        };\r\n\r\n        markedRenderer.code = function (code, lang, escaped) { \r\n\r\n            if (lang === \"seq\" || lang === \"sequence\")\r\n            {\r\n                return \"<div class=\\\"sequence-diagram\\\">\" + code + \"</div>\";\r\n            } \r\n            else if ( lang === \"flow\")\r\n            {\r\n                return \"<div class=\\\"flowchart\\\">\" + code + \"</div>\";\r\n            } \r\n            else if ( lang === \"math\" || lang === \"latex\" || lang === \"katex\")\r\n            {\r\n                return \"<p class=\\\"\" + editormd.classNames.tex + \"\\\">\" + code + \"</p>\";\r\n            } \r\n            else \r\n            {\r\n\r\n                return marked.Renderer.prototype.code.apply(this, arguments);\r\n            }\r\n        };\r\n\r\n        markedRenderer.tablecell = function(content, flags) {\r\n            var type = (flags.header) ? \"th\" : \"td\";\r\n            var tag  = (flags.align)  ? \"<\" + type +\" style=\\\"text-align:\" + flags.align + \"\\\">\" : \"<\" + type + \">\";\r\n            \r\n            return tag + this.atLink(this.emoji(content)) + \"</\" + type + \">\\n\";\r\n        };\r\n\r\n        markedRenderer.listitem = function(text) {\r\n            if (settings.taskList && /^\\s*\\[[x\\s]\\]\\s*/.test(text)) \r\n            {\r\n                text = text.replace(/^\\s*\\[\\s\\]\\s*/, \"<input type=\\\"checkbox\\\" class=\\\"task-list-item-checkbox\\\" /> \")\r\n                           .replace(/^\\s*\\[x\\]\\s*/,  \"<input type=\\\"checkbox\\\" class=\\\"task-list-item-checkbox\\\" checked disabled /> \");\r\n\r\n                return \"<li style=\\\"list-style: none;\\\">\" + this.atLink(this.emoji(text)) + \"</li>\";\r\n            }\r\n            else \r\n            {\r\n                return \"<li>\" + this.atLink(this.emoji(text)) + \"</li>\";\r\n            }\r\n        };\r\n        \r\n        return markedRenderer;\r\n    };\r\n    \r\n    /**\r\n     *\r\n     * TOC(Table of Contents)\r\n     * Creating ToC (Table of Contents)\r\n     * \r\n     * @param   {Array}    toc             markedTOC\r\n     * @param   {Element}  container       TOC\r\n     * @param   {Integer}  startLevel      Hx \r\n     * @returns {Object}   tocContainer    ToCjQuery\r\n     */\r\n    \r\n    editormd.markdownToCRenderer = function(toc, container, tocDropdown, startLevel) {\r\n        \r\n        var html        = \"\";    \r\n        var lastLevel   = 0;\r\n        var classPrefix = this.classPrefix;\r\n        \r\n        startLevel      = startLevel  || 1;\r\n        \r\n        for (var i = 0, len = toc.length; i < len; i++) \r\n        {\r\n            var text  = toc[i].text;\r\n            var level = toc[i].level;\r\n            \r\n            if (level < startLevel) {\r\n                continue;\r\n            }\r\n            \r\n            if (level > lastLevel) \r\n            {\r\n                html += \"\";\r\n            }\r\n            else if (level < lastLevel) \r\n            {\r\n                html += (new Array(lastLevel - level + 2)).join(\"</ul></li>\");\r\n            } \r\n            else \r\n            {\r\n                html += \"</ul></li>\";\r\n            }\r\n\r\n            html += \"<li><a class=\\\"toc-level-\" + level + \"\\\" href=\\\"#\" + text + \"\\\" level=\\\"\" + level + \"\\\">\" + text + \"</a><ul>\";\r\n            lastLevel = level;\r\n        }\r\n        \r\n        var tocContainer = container.find(\".markdown-toc\");\r\n        \r\n        if ((tocContainer.length < 1 && container.attr(\"previewContainer\") === \"false\"))\r\n        {\r\n            var tocHTML = \"<div class=\\\"markdown-toc \" + classPrefix + \"markdown-toc\\\"></div>\";\r\n            \r\n            tocHTML = (tocDropdown) ? \"<div class=\\\"\" + classPrefix + \"toc-menu\\\">\" + tocHTML + \"</div>\" : tocHTML;\r\n            \r\n            container.html(tocHTML);\r\n            \r\n            tocContainer = container.find(\".markdown-toc\");\r\n        }\r\n        \r\n        if (tocDropdown)\r\n        {\r\n            tocContainer.wrap(\"<div class=\\\"\" + classPrefix + \"toc-menu\\\"></div><br/>\");\r\n        }\r\n        \r\n        tocContainer.html(\"<ul class=\\\"markdown-toc-list\\\"></ul>\").children(\".markdown-toc-list\").html(html.replace(/\\r?\\n?\\<ul\\>\\<\\/ul\\>/g, \"\"));\r\n        \r\n        return tocContainer;\r\n    };\r\n    \r\n    /**\r\n     *\r\n     * TOC\r\n     * Creating ToC dropdown menu\r\n     * \r\n     * @param   {Object}   container       TOCjQuery\r\n     * @param   {String}   tocTitle        ToC title\r\n     * @returns {Object}                   return toc-menu object\r\n     */\r\n    \r\n    editormd.tocDropdownMenu = function(container, tocTitle) {\r\n        \r\n        tocTitle      = tocTitle || \"Table of Contents\";\r\n        \r\n        var zindex    = 400;\r\n        var tocMenus  = container.find(\".\" + this.classPrefix + \"toc-menu\");\r\n\r\n        tocMenus.each(function() {\r\n            var $this  = $(this);\r\n            var toc    = $this.children(\".markdown-toc\");\r\n            var icon   = \"<i class=\\\"fa fa-angle-down\\\"></i>\";\r\n            var btn    = \"<a href=\\\"javascript:;\\\" class=\\\"toc-menu-btn\\\">\" + icon + tocTitle + \"</a>\";\r\n            var menu   = toc.children(\"ul\");            \r\n            var list   = menu.find(\"li\");\r\n            \r\n            toc.append(btn);\r\n            \r\n            list.first().before(\"<li><h1>\" + tocTitle + \" \" + icon + \"</h1></li>\");\r\n            \r\n            $this.mouseover(function(){\r\n                menu.show();\r\n\r\n                list.each(function(){\r\n                    var li = $(this);\r\n                    var ul = li.children(\"ul\");\r\n\r\n                    if (ul.html() === \"\")\r\n                    {\r\n                        ul.remove();\r\n                    }\r\n\r\n                    if (ul.length > 0 && ul.html() !== \"\")\r\n                    {\r\n                        var firstA = li.children(\"a\").first();\r\n\r\n                        if (firstA.children(\".fa\").length < 1)\r\n                        {\r\n                            firstA.append( $(icon).css({ float:\"right\", paddingTop:\"4px\" }) );\r\n                        }\r\n                    }\r\n\r\n                    li.mouseover(function(){\r\n                        ul.css(\"z-index\", zindex).show();\r\n                        zindex += 1;\r\n                    }).mouseleave(function(){\r\n                        ul.hide();\r\n                    });\r\n                });\r\n            }).mouseleave(function(){\r\n                menu.hide();\r\n            }); \r\n        });       \r\n        \r\n        return tocMenus;\r\n    };\r\n    \r\n    /**\r\n     * HTML\r\n     * Filter custom html tags\r\n     * \r\n     * @param   {String}   html          HTML\r\n     * @param   {String}   filters       \r\n     * @returns {String}   html          HTML\r\n     */\r\n    \r\n    editormd.filterHTMLTags = function(html, filters) {\r\n        \r\n        if (typeof html !== \"string\") {\r\n            html = new String(html);\r\n        }\r\n            \r\n        if (typeof filters !== \"string\") {\r\n            return html;\r\n        }\r\n\r\n        var expression = filters.split(\"|\");\r\n        var filterTags = expression[0].split(\",\");\r\n        var attrs      = expression[1];\r\n\r\n        for (var i = 0, len = filterTags.length; i < len; i++)\r\n        {\r\n            var tag = filterTags[i];\r\n\r\n            html = html.replace(new RegExp(\"\\<\\s*\" + tag + \"\\s*([^\\>]*)\\>([^\\>]*)\\<\\s*\\/\" + tag + \"\\s*\\>\", \"igm\"), \"\");\r\n        }\r\n        \r\n        //return html;\r\n\r\n        if (typeof attrs !== \"undefined\")\r\n        {\r\n            var htmlTagRegex = /\\<(\\w+)\\s*([^\\>]*)\\>([^\\>]*)\\<\\/(\\w+)\\>/ig;\r\n\r\n            if (attrs === \"*\")\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4, $5) {\r\n                    return \"<\" + $2 + \">\" + $4 + \"</\" + $5 + \">\";\r\n                });         \r\n            }\r\n            else if (attrs === \"on*\")\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4, $5) {\r\n                    var el = $(\"<\" + $2 + \">\" + $4 + \"</\" + $5 + \">\");\r\n                    var _attrs = $($1)[0].attributes;\r\n                    var $attrs = {};\r\n                    \r\n                    $.each(_attrs, function(i, e) {\r\n                        if (e.nodeName !== '\"') $attrs[e.nodeName] = e.nodeValue;\r\n                    });\r\n                    \r\n                    $.each($attrs, function(i) {                        \r\n                        if (i.indexOf(\"on\") === 0) {\r\n                            delete $attrs[i];\r\n                        }\r\n                    });\r\n                    \r\n                    el.attr($attrs);\r\n                    \r\n                    var text = (typeof el[1] !== \"undefined\") ? $(el[1]).text() : \"\";\r\n\r\n                    return el[0].outerHTML + text;\r\n                });\r\n            }\r\n            else\r\n            {\r\n                html = html.replace(htmlTagRegex, function($1, $2, $3, $4) {\r\n                    var filterAttrs = attrs.split(\",\");\r\n                    var el = $($1);\r\n                    el.html($4);\r\n\r\n                    $.each(filterAttrs, function(i) {\r\n                        el.attr(filterAttrs[i], null);\r\n                    });\r\n\r\n                    return el[0].outerHTML;\r\n                });\r\n            }\r\n        }\r\n        \r\n        return html;\r\n    };\r\n    \r\n    /**\r\n     * MarkdownHTML\r\n     * Parse Markdown to HTML for Font-end preview.\r\n     * \r\n     * @param   {String}   id            HTMLID\r\n     * @param   {Object}   [options={}]  \r\n     * @returns {Object}   div           jQuery\r\n     */\r\n    \r\n    editormd.markdownToHTML = function(id, options) {\r\n        var defaults = {\r\n            gfm                  : true,\r\n            toc                  : true,\r\n            tocm                 : false,\r\n            tocStartLevel        : 1,\r\n            tocTitle             : \"\",\r\n            tocDropdown          : false,\r\n            tocContainer         : \"\",\r\n            markdown             : \"\",\r\n            markdownSourceCode   : false,\r\n            htmlDecode           : false,\r\n            autoLoadKaTeX        : true,\r\n            pageBreak            : true,\r\n            atLink               : true,    // for @link\r\n            emailLink            : true,    // for mail address auto link\r\n            tex                  : false,\r\n            taskList             : false,   // Github Flavored Markdown task lists\r\n            emoji                : false,\r\n            flowChart            : false,\r\n            sequenceDiagram      : false,\r\n            previewCodeHighlight : true\r\n        };\r\n        \r\n        editormd.$marked  = marked;\r\n\r\n        var div           = $(\"#\" + id);\r\n        var settings      = div.settings = $.extend(true, defaults, options || {});\r\n        var saveTo        = div.find(\"textarea\");\r\n        \r\n        if (saveTo.length < 1)\r\n        {\r\n            div.append(\"<textarea></textarea>\");\r\n            saveTo        = div.find(\"textarea\");\r\n        }        \r\n        \r\n        var markdownDoc   = (settings.markdown === \"\") ? saveTo.val() : settings.markdown; \r\n        var markdownToC   = [];\r\n\r\n        var rendererOptions = {  \r\n            toc                  : settings.toc,\r\n            tocm                 : settings.tocm,\r\n            tocStartLevel        : settings.tocStartLevel,\r\n            taskList             : settings.taskList,\r\n            emoji                : settings.emoji,\r\n            tex                  : settings.tex,\r\n            pageBreak            : settings.pageBreak,\r\n            atLink               : settings.atLink,           // for @link\r\n            emailLink            : settings.emailLink,        // for mail address auto link\r\n            flowChart            : settings.flowChart,\r\n            sequenceDiagram      : settings.sequenceDiagram,\r\n            previewCodeHighlight : settings.previewCodeHighlight,\r\n        };\r\n\r\n        var markedOptions = {\r\n            renderer    : editormd.markedRenderer(markdownToC, rendererOptions),\r\n            gfm         : settings.gfm,\r\n            tables      : true,\r\n            breaks      : true,\r\n            pedantic    : false,\r\n            sanitize    : (settings.htmlDecode) ? false : true, // HTMLHTML\r\n            smartLists  : true,\r\n            smartypants : true\r\n        };\r\n        \r\n\t\tmarkdownDoc = new String(markdownDoc);\r\n        \r\n        var markdownParsed = marked(markdownDoc, markedOptions);\r\n        \r\n        markdownParsed = editormd.filterHTMLTags(markdownParsed, settings.htmlDecode);\r\n        \r\n        if (settings.markdownSourceCode) {\r\n            saveTo.text(markdownDoc);\r\n        } else {\r\n            saveTo.remove();\r\n        }\r\n        \r\n        div.addClass(\"markdown-body \" + this.classPrefix + \"html-preview\").append(markdownParsed);\r\n        \r\n        var tocContainer = (settings.tocContainer !== \"\") ? $(settings.tocContainer) : div;\r\n        \r\n        if (settings.tocContainer !== \"\")\r\n        {\r\n            tocContainer.attr(\"previewContainer\", false);\r\n        }\r\n         \r\n        if (settings.toc) \r\n        {\r\n            div.tocContainer = this.markdownToCRenderer(markdownToC, tocContainer, settings.tocDropdown, settings.tocStartLevel);\r\n            \r\n            if (settings.tocDropdown || div.find(\".\" + this.classPrefix + \"toc-menu\").length > 0)\r\n            {\r\n                this.tocDropdownMenu(div, settings.tocTitle);\r\n            }\r\n            \r\n            if (settings.tocContainer !== \"\")\r\n            {\r\n                div.find(\".editormd-toc-menu, .editormd-markdown-toc\").remove();\r\n            }\r\n        }\r\n            \r\n        if (settings.previewCodeHighlight) \r\n        {\r\n            div.find(\"pre\").addClass(\"prettyprint linenums\");\r\n            prettyPrint();\r\n        }\r\n        \r\n        if (!editormd.isIE8) \r\n        {\r\n            if (settings.flowChart) {\r\n                div.find(\".flowchart\").flowChart(); \r\n            }\r\n\r\n            if (settings.sequenceDiagram) {\r\n                div.find(\".sequence-diagram\").sequenceDiagram({theme: \"simple\"});\r\n            }\r\n        }\r\n\r\n        if (settings.tex)\r\n        {\r\n            var katexHandle = function() {\r\n                div.find(\".\" + editormd.classNames.tex).each(function(){\r\n                    var tex  = $(this);                    \r\n                    katex.render(tex.html().replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\"), tex[0]);                    \r\n                    tex.find(\".katex\").css(\"font-size\", \"1.6em\");\r\n                });\r\n            };\r\n            \r\n            if (settings.autoLoadKaTeX && !editormd.$katex && !editormd.kaTeXLoaded)\r\n            {\r\n                this.loadKaTeX(function() {\r\n                    editormd.$katex      = katex;\r\n                    editormd.kaTeXLoaded = true;\r\n                    katexHandle();\r\n                });\r\n            }\r\n            else\r\n            {\r\n                katexHandle();\r\n            }\r\n        }\r\n        \r\n        div.getMarkdown = function() {            \r\n            return saveTo.val();\r\n        };\r\n        \r\n        return div;\r\n    };\r\n    \r\n    // Editor.md themes, change toolbar themes etc.\r\n    // added @1.5.0\r\n    editormd.themes        = [\"default\", \"dark\"];\r\n    \r\n    // Preview area themes\r\n    // added @1.5.0\r\n    editormd.previewThemes = [\"default\", \"dark\"];\r\n    \r\n    // CodeMirror / editor area themes\r\n    // @1.5.0 rename -> editorThemes, old version -> themes\r\n    editormd.editorThemes = [\r\n        \"default\", \"3024-day\", \"3024-night\",\r\n        \"ambiance\", \"ambiance-mobile\",\r\n        \"base16-dark\", \"base16-light\", \"blackboard\",\r\n        \"cobalt\",\r\n        \"eclipse\", \"elegant\", \"erlang-dark\",\r\n        \"lesser-dark\",\r\n        \"mbo\", \"mdn-like\", \"midnight\", \"monokai\",\r\n        \"neat\", \"neo\", \"night\",\r\n        \"paraiso-dark\", \"paraiso-light\", \"pastel-on-dark\",\r\n        \"rubyblue\",\r\n        \"solarized\",\r\n        \"the-matrix\", \"tomorrow-night-eighties\", \"twilight\",\r\n        \"vibrant-ink\",\r\n        \"xq-dark\", \"xq-light\"\r\n    ];\r\n\r\n    editormd.loadPlugins = {};\r\n    \r\n    editormd.loadFiles = {\r\n        js     : [],\r\n        css    : [],\r\n        plugin : []\r\n    };\r\n    \r\n    /**\r\n     * Editor.md\r\n     * Load editor.md plugins\r\n     * \r\n     * @param {String}   fileName              \r\n     * @param {Function} [callback=function()] \r\n     * @param {String}   [into=\"head\"]         \r\n     */\r\n    \r\n    editormd.loadPlugin = function(fileName, callback, into) {\r\n        callback   = callback || function() {};\r\n        \r\n        this.loadScript(fileName, function() {\r\n            editormd.loadFiles.plugin.push(fileName);\r\n            callback();\r\n        }, into);\r\n    };\r\n    \r\n    /**\r\n     * CSS\r\n     * Load css file method\r\n     * \r\n     * @param {String}   fileName              CSS\r\n     * @param {Function} [callback=function()] \r\n     * @param {String}   [into=\"head\"]         \r\n     */\r\n    \r\n    editormd.loadCSS   = function(fileName, callback, into) {\r\n        into       = into     || \"head\";        \r\n        callback   = callback || function() {};\r\n        \r\n        var css    = document.createElement(\"link\");\r\n        css.type   = \"text/css\";\r\n        css.rel    = \"stylesheet\";\r\n        css.onload = css.onreadystatechange = function() {\r\n            editormd.loadFiles.css.push(fileName);\r\n            callback();\r\n        };\r\n\r\n        css.href   = fileName + \".css\";\r\n\r\n        if(into === \"head\") {\r\n            document.getElementsByTagName(\"head\")[0].appendChild(css);\r\n        } else {\r\n            document.body.appendChild(css);\r\n        }\r\n    };\r\n    \r\n    editormd.isIE    = (navigator.appName == \"Microsoft Internet Explorer\");\r\n    editormd.isIE8   = (editormd.isIE && navigator.appVersion.match(/8./i) == \"8.\");\r\n\r\n    /**\r\n     * JS\r\n     * Load javascript file method\r\n     * \r\n     * @param {String}   fileName              JS\r\n     * @param {Function} [callback=function()] \r\n     * @param {String}   [into=\"head\"]         \r\n     */\r\n\r\n    editormd.loadScript = function(fileName, callback, into) {\r\n        \r\n        into          = into     || \"head\";\r\n        callback      = callback || function() {};\r\n        \r\n        var script    = null; \r\n        script        = document.createElement(\"script\");\r\n        script.id     = fileName.replace(/[\\./]+/g, \"-\");\r\n        script.type   = \"text/javascript\";        \r\n        script.src    = fileName + \".js\";\r\n        \r\n        if (editormd.isIE8) \r\n        {            \r\n            script.onreadystatechange = function() {\r\n                if(script.readyState) \r\n                {\r\n                    if (script.readyState === \"loaded\" || script.readyState === \"complete\") \r\n                    {\r\n                        script.onreadystatechange = null; \r\n                        editormd.loadFiles.js.push(fileName);\r\n                        callback();\r\n                    }\r\n                } \r\n            };\r\n        }\r\n        else\r\n        {\r\n            script.onload = function() {\r\n                editormd.loadFiles.js.push(fileName);\r\n                callback();\r\n            };\r\n        }\r\n\r\n        if (into === \"head\") {\r\n            document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n        } else {\r\n            document.body.appendChild(script);\r\n        }\r\n    };\r\n    \r\n    // CDNURL\r\n    // You can custom KaTeX load url.\r\n    editormd.katexURL  = {\r\n        css : \"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\",\r\n        js  : \"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min\"\r\n    };\r\n    \r\n    editormd.kaTeXLoaded = false;\r\n    \r\n    /**\r\n     * KaTeX\r\n     * load KaTeX files\r\n     * \r\n     * @param {Function} [callback=function()]  \r\n     */\r\n    \r\n    editormd.loadKaTeX = function (callback) {\r\n        editormd.loadCSS(editormd.katexURL.css, function(){\r\n            editormd.loadScript(editormd.katexURL.js, callback || function(){});\r\n        });\r\n    };\r\n        \r\n    /**\r\n     * \r\n     * lock screen\r\n     * \r\n     * @param   {Boolean}   lock   Boolean \r\n     * @returns {void}\r\n     */\r\n    \r\n    editormd.lockScreen = function(lock) {\r\n        $(\"html,body\").css(\"overflow\", (lock) ? \"hidden\" : \"\");\r\n    };\r\n        \r\n    /**\r\n     * \r\n     * Creating custom dialogs\r\n     * \r\n     * @param   {Object} options  Key/Value\r\n     * @returns {dialog} dialogjQuery\r\n     */\r\n\r\n    editormd.createDialog = function(options) {\r\n        var defaults = {\r\n            name : \"\",\r\n            width : 420,\r\n            height: 240,\r\n            title : \"\",\r\n            drag  : true,\r\n            closed : true,\r\n            content : \"\",\r\n            mask : true,\r\n            maskStyle : {\r\n                backgroundColor : \"#fff\",\r\n                opacity : 0.1\r\n            },\r\n            lockScreen : true,\r\n            footer : true,\r\n            buttons : false\r\n        };\r\n\r\n        options          = $.extend(true, defaults, options);\r\n        \r\n        var $this        = this;\r\n        var editor       = this.editor;\r\n        var classPrefix  = editormd.classPrefix;\r\n        var guid         = (new Date()).getTime();\r\n        var dialogName   = ( (options.name === \"\") ? classPrefix + \"dialog-\" + guid : options.name);\r\n        var mouseOrTouch = editormd.mouseOrTouch;\r\n\r\n        var html         = \"<div class=\\\"\" + classPrefix + \"dialog \" + dialogName + \"\\\">\";\r\n\r\n        if (options.title !== \"\")\r\n        {\r\n            html += \"<div class=\\\"\" + classPrefix + \"dialog-header\\\"\" + ( (options.drag) ? \" style=\\\"cursor: move;\\\"\" : \"\" ) + \">\";\r\n            html += \"<strong class=\\\"\" + classPrefix + \"dialog-title\\\">\" + options.title + \"</strong>\";\r\n            html += \"</div>\";\r\n        }\r\n\r\n        if (options.closed)\r\n        {\r\n            html += \"<a href=\\\"javascript:;\\\" class=\\\"fa fa-close \" + classPrefix + \"dialog-close\\\"></a>\";\r\n        }\r\n\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-container\\\">\" + options.content;                    \r\n\r\n        if (options.footer || typeof options.footer === \"string\") \r\n        {\r\n            html += \"<div class=\\\"\" + classPrefix + \"dialog-footer\\\">\" + ( (typeof options.footer === \"boolean\") ? \"\" : options.footer) + \"</div>\";\r\n        }\r\n\r\n        html += \"</div>\";\r\n\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-mask \" + classPrefix + \"dialog-mask-bg\\\"></div>\";\r\n        html += \"<div class=\\\"\" + classPrefix + \"dialog-mask \" + classPrefix + \"dialog-mask-con\\\"></div>\";\r\n        html += \"</div>\";\r\n\r\n        editor.append(html);\r\n\r\n        var dialog = editor.find(\".\" + dialogName);\r\n\r\n        dialog.lockScreen = function(lock) {\r\n            if (options.lockScreen)\r\n            {                \r\n                $(\"html,body\").css(\"overflow\", (lock) ? \"hidden\" : \"\");\r\n                $this.resize();\r\n            }\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.showMask = function() {\r\n            if (options.mask)\r\n            {\r\n                editor.find(\".\" + classPrefix + \"mask\").css(options.maskStyle).css(\"z-index\", editormd.dialogZindex - 1).show();\r\n            }\r\n            return dialog;\r\n        };\r\n\r\n        dialog.hideMask = function() {\r\n            if (options.mask)\r\n            {\r\n                editor.find(\".\" + classPrefix + \"mask\").hide();\r\n            }\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.loading = function(show) {                        \r\n            var loading = dialog.find(\".\" + classPrefix + \"dialog-mask\");\r\n            loading[(show) ? \"show\" : \"hide\"]();\r\n\r\n            return dialog;\r\n        };\r\n\r\n        dialog.lockScreen(true).showMask();\r\n\r\n        dialog.show().css({\r\n            zIndex : editormd.dialogZindex,\r\n            border : (editormd.isIE8) ? \"1px solid #ddd\" : \"\",\r\n            width  : (typeof options.width  === \"number\") ? options.width + \"px\"  : options.width,\r\n            height : (typeof options.height === \"number\") ? options.height + \"px\" : options.height\r\n        });\r\n\r\n        var dialogPosition = function(){\r\n            dialog.css({\r\n                top    : ($(window).height() - dialog.height()) / 2 + \"px\",\r\n                left   : ($(window).width() - dialog.width()) / 2 + \"px\"\r\n            });\r\n        };\r\n\r\n        dialogPosition();\r\n\r\n        $(window).resize(dialogPosition);\r\n\r\n        dialog.children(\".\" + classPrefix + \"dialog-close\").bind(mouseOrTouch(\"click\", \"touchend\"), function() {\r\n            dialog.hide().lockScreen(false).hideMask();\r\n        });\r\n\r\n        if (typeof options.buttons === \"object\")\r\n        {\r\n            var footer = dialog.footer = dialog.find(\".\" + classPrefix + \"dialog-footer\");\r\n\r\n            for (var key in options.buttons)\r\n            {\r\n                var btn = options.buttons[key];\r\n                var btnClassName = classPrefix + key + \"-btn\";\r\n\r\n                footer.append(\"<button class=\\\"\" + classPrefix + \"btn \" + btnClassName + \"\\\">\" + btn[0] + \"</button>\");\r\n                btn[1] = $.proxy(btn[1], dialog);\r\n                footer.children(\".\" + btnClassName).bind(mouseOrTouch(\"click\", \"touchend\"), btn[1]);\r\n            }\r\n        }\r\n\r\n        if (options.title !== \"\" && options.drag)\r\n        {                        \r\n            var posX, posY;\r\n            var dialogHeader = dialog.children(\".\" + classPrefix + \"dialog-header\");\r\n\r\n            if (!options.mask) {\r\n                dialogHeader.bind(mouseOrTouch(\"click\", \"touchend\"), function(){\r\n                    editormd.dialogZindex += 2;\r\n                    dialog.css(\"z-index\", editormd.dialogZindex);\r\n                });\r\n            }\r\n\r\n            dialogHeader.mousedown(function(e) {\r\n                e = e || window.event;  //IE\r\n                posX = e.clientX - parseInt(dialog[0].style.left);\r\n                posY = e.clientY - parseInt(dialog[0].style.top);\r\n\r\n                document.onmousemove = moveAction;                   \r\n            });\r\n\r\n            var userCanSelect = function (obj) {\r\n                obj.removeClass(classPrefix + \"user-unselect\").off(\"selectstart\");\r\n            };\r\n\r\n            var userUnselect = function (obj) {\r\n                obj.addClass(classPrefix + \"user-unselect\").on(\"selectstart\", function(event) { // selectstart for IE                        \r\n                    return false;\r\n                });\r\n            };\r\n\r\n            var moveAction = function (e) {\r\n                e = e || window.event;  //IE\r\n\r\n                var left, top, nowLeft = parseInt(dialog[0].style.left), nowTop = parseInt(dialog[0].style.top);\r\n\r\n                if( nowLeft >= 0 ) {\r\n                    if( nowLeft + dialog.width() <= $(window).width()) {\r\n                        left = e.clientX - posX;\r\n                    } else {\t\r\n                        left = $(window).width() - dialog.width();\r\n                        document.onmousemove = null;\r\n                    }\r\n                } else {\r\n                    left = 0;\r\n                    document.onmousemove = null;\r\n                }\r\n\r\n                if( nowTop >= 0 ) {\r\n                    top = e.clientY - posY;\r\n                } else {\r\n                    top = 0;\r\n                    document.onmousemove = null;\r\n                }\r\n\r\n\r\n                document.onselectstart = function() {\r\n                    return false;\r\n                };\r\n\r\n                userUnselect($(\"body\"));\r\n                userUnselect(dialog);\r\n                dialog[0].style.left = left + \"px\";\r\n                dialog[0].style.top  = top + \"px\";\r\n            };\r\n\r\n            document.onmouseup = function() {                            \r\n                userCanSelect($(\"body\"));\r\n                userCanSelect(dialog);\r\n\r\n                document.onselectstart = null;         \r\n                document.onmousemove = null;\r\n            };\r\n\r\n            dialogHeader.touchDraggable = function() {\r\n                var offset = null;\r\n                var start  = function(e) {\r\n                    var orig = e.originalEvent; \r\n                    var pos  = $(this).parent().position();\r\n\r\n                    offset = {\r\n                        x : orig.changedTouches[0].pageX - pos.left,\r\n                        y : orig.changedTouches[0].pageY - pos.top\r\n                    };\r\n                };\r\n\r\n                var move = function(e) {\r\n                    e.preventDefault();\r\n                    var orig = e.originalEvent;\r\n\r\n                    $(this).parent().css({\r\n                        top  : orig.changedTouches[0].pageY - offset.y,\r\n                        left : orig.changedTouches[0].pageX - offset.x\r\n                    });\r\n                };\r\n\r\n                this.bind(\"touchstart\", start).bind(\"touchmove\", move);\r\n            };\r\n\r\n            dialogHeader.touchDraggable();\r\n        }\r\n\r\n        editormd.dialogZindex += 2;\r\n\r\n        return dialog;\r\n    };\r\n    \r\n    /**\r\n     * /\r\n     * MouseEvent or TouchEvent type switch\r\n     * \r\n     * @param   {String} [mouseEventType=\"click\"]    \r\n     * @param   {String} [touchEventType=\"touchend\"] \r\n     * @returns {String} EventType                   \r\n     */\r\n    \r\n    editormd.mouseOrTouch = function(mouseEventType, touchEventType) {\r\n        mouseEventType = mouseEventType || \"click\";\r\n        touchEventType = touchEventType || \"touchend\";\r\n        \r\n        var eventType  = mouseEventType;\r\n\r\n        try {\r\n            document.createEvent(\"TouchEvent\");\r\n            eventType = touchEventType;\r\n        } catch(e) {}\r\n\r\n        return eventType;\r\n    };\r\n    \r\n    /**\r\n     * \r\n     * Datetime format method\r\n     * \r\n     * @param   {String}   [format=\"\"]  PHP\r\n     * @returns {String}   datefmt      \r\n     */\r\n    \r\n    editormd.dateFormat = function(format) {                \r\n        format      = format || \"\";\r\n\r\n        var addZero = function(d) {\r\n            return (d < 10) ? \"0\" + d : d;\r\n        };\r\n\r\n        var date    = new Date(); \r\n        var year    = date.getFullYear();\r\n        var year2   = year.toString().slice(2, 4);\r\n        var month   = addZero(date.getMonth() + 1);\r\n        var day     = addZero(date.getDate());\r\n        var weekDay = date.getDay();\r\n        var hour    = addZero(date.getHours());\r\n        var min     = addZero(date.getMinutes());\r\n        var second  = addZero(date.getSeconds());\r\n        var ms      = addZero(date.getMilliseconds()); \r\n        var datefmt = \"\";\r\n\r\n        var ymd     = year2 + \"-\" + month + \"-\" + day;\r\n        var fymd    = year  + \"-\" + month + \"-\" + day;\r\n        var hms     = hour  + \":\" + min   + \":\" + second;\r\n\r\n        switch (format) \r\n        {\r\n            case \"UNIX Time\" :\r\n                    datefmt = date.getTime();\r\n                break;\r\n\r\n            case \"UTC\" :\r\n                    datefmt = date.toUTCString();\r\n                break;\t\r\n\r\n            case \"yy\" :\r\n                    datefmt = year2;\r\n                break;\t\r\n\r\n            case \"year\" :\r\n            case \"yyyy\" :\r\n                    datefmt = year;\r\n                break;\r\n\r\n            case \"month\" :\r\n            case \"mm\" :\r\n                    datefmt = month;\r\n                break;                        \r\n\r\n            case \"cn-week-day\" :\r\n            case \"cn-wd\" :\r\n                    var cnWeekDays = [\"\", \"\", \"\", \"\", \"\", \"\", \"\"];\r\n                    datefmt = \"\" + cnWeekDays[weekDay];\r\n                break;\r\n\r\n            case \"week-day\" :\r\n            case \"wd\" :\r\n                    var weekDays = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\n                    datefmt = weekDays[weekDay];\r\n                break;\r\n\r\n            case \"day\" :\r\n            case \"dd\" :\r\n                    datefmt = day;\r\n                break;\r\n\r\n            case \"hour\" :\r\n            case \"hh\" :\r\n                    datefmt = hour;\r\n                break;\r\n\r\n            case \"min\" :\r\n            case \"ii\" :\r\n                    datefmt = min;\r\n                break;\r\n\r\n            case \"second\" :\r\n            case \"ss\" :\r\n                    datefmt = second;\r\n                break;\r\n\r\n            case \"ms\" :\r\n                    datefmt = ms;\r\n                break;\r\n\r\n            case \"yy-mm-dd\" :\r\n                    datefmt = ymd;\r\n                break;\r\n\r\n            case \"yyyy-mm-dd\" :\r\n                    datefmt = fymd;\r\n                break;\r\n\r\n            case \"yyyy-mm-dd h:i:s ms\" :\r\n            case \"full + ms\" : \r\n                    datefmt = fymd + \" \" + hms + \" \" + ms;\r\n                break;\r\n\r\n            case \"full\" :\r\n            case \"yyyy-mm-dd h:i:s\" :\r\n                default:\r\n                    datefmt = fymd + \" \" + hms;\r\n                break;\r\n        }\r\n\r\n        return datefmt;\r\n    };\r\n\r\n    return editormd;\r\n\r\n}));\r\n"]}